

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>spaic.Neuron.Neuron &mdash; SPAIC 0.5 文档</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> SPAIC
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_structure/0_index.html">基础结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input_output.html">输入输出</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../backend.html">模拟后端 Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../save_model.html">保存与读取模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../custom/0_index.html">自定义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../monitor.html">监视器</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SPAIC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">模块代码</a> &raquo;</li>
        
      <li>spaic.Neuron.Neuron</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>spaic.Neuron.Neuron 源代码</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on 2020/8/5</span>
<span class="sd">@project: SPAIC</span>
<span class="sd">@filename: Neuron</span>
<span class="sd">@author: Hong Chaofei</span>
<span class="sd">@contact: hongchf@gmail.com</span>

<span class="sd">@description:</span>
<span class="sd">定义神经集群和神经元模型。</span>
<span class="sd">神经元集群保存神经元数目、神经元编号、类型、模型、模型参数、神经元位置等信息，参与网络构建</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># print(&#39;__file__={0:&lt;35} | __name__={1:&lt;20} | __package__={2:&lt;20}&#39;.format(__file__,__name__,str(__package__)))</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">..Network</span> <span class="kn">import</span> <span class="n">Assembly</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">..Network.BaseModule</span> <span class="kn">import</span> <span class="n">VariableAgent</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="c1"># from brian2 import *</span>

<div class="viewcode-block" id="NeuronGroup"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronGroup">[文档]</a><span class="k">class</span> <span class="nc">NeuronGroup</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class for a group of neurons.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">_class_label</span> <span class="o">=</span> <span class="s1">&#39;&lt;neg&gt;&#39;</span>
    <span class="n">_is_terminal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">neuron_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">neuron_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">neuron_type</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;excitatory&#39;</span><span class="p">,</span> <span class="s1">&#39;inhibitory&#39;</span><span class="p">,</span> <span class="s1">&#39;pyramidal&#39;</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">),</span>
                 <span class="n">neuron_position</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x, y, z&#39;</span> <span class="ow">or</span> <span class="s1">&#39;x, y&#39;</span><span class="p">),</span>
                 <span class="n">neuron_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span>
                 <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NeuronGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_num_shape</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">neuron_number</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">neuron_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outlayer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outlayer&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># self.neuron_model = neuron_model</span>
        <span class="k">if</span> <span class="n">neuron_type</span> <span class="o">==</span> <span class="p">(</span><span class="s1">&#39;excitatory&#39;</span><span class="p">,</span> <span class="s1">&#39;inhibitory&#39;</span><span class="p">,</span> <span class="s1">&#39;pyramidal&#39;</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nontype&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">neuron_type</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">neuron_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="p">[</span><span class="n">neuron_type</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">neuron_position</span> <span class="o">==</span> <span class="p">(</span><span class="s1">&#39;x, y, z&#39;</span> <span class="ow">or</span> <span class="s1">&#39;x, y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">neuron_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">neuron_position</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">neuron_position</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">neuron_number</span><span class="p">,</span> <span class="s2">&quot; Neuron_position not equal to neuron number&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">neuron_position</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">neuron_model</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_class</span> <span class="o">=</span> <span class="n">NeuronModel</span><span class="o">.</span><span class="n">apply_model</span><span class="p">(</span><span class="n">neuron_model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">neuron_model</span>  <span class="c1"># self.neuron_model -&gt; self.model_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">neuron_model</span><span class="p">,</span> <span class="n">NeuronModel</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">neuron_model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_class</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;custom_model&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;only support set neuron model with string or NeuronModel class constructed by @custom_model()&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_operations</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>


<div class="viewcode-block" id="NeuronGroup.set_num_shape"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronGroup.set_num_shape">[文档]</a>    <span class="k">def</span> <span class="nf">set_num_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="n">num</span><span class="p">,</span> <span class="s2">&quot;the neuron number is not accord with neuron shape&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;neither neuron number nor neuron shape is defined&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NeuronGroup.set_parameter"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronGroup.set_parameter">[文档]</a>    <span class="k">def</span> <span class="nf">set_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="NeuronGroup.get_model"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronGroup.get_model">[文档]</a>    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span></div>

    <span class="k">def</span> <span class="nf">_add_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;[dt]&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">key</span>
            <span class="k">elif</span> <span class="s1">&#39;[updated]&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[updated]&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span> <span class="o">+</span> <span class="s1">&#39;[updated]&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">VariableAgent</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">var_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; the key data type is not supported for add_label&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="NeuronGroup.add_neuron_label"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronGroup.add_neuron_label">[文档]</a>    <span class="k">def</span> <span class="nf">add_neuron_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">VariableAgent</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_label</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_label</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">keys</span></div>

<div class="viewcode-block" id="NeuronGroup.build"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronGroup.build">[文档]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        backend : Backend.Backend</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">get_batch_size</span><span class="p">()</span>
        <span class="c1"># if(self.parameters is not None):</span>
        <span class="c1">#     self.model = self.model_class(**self.model_parameters)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     self.model = self.model_class()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;dt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">dt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_class</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>


        <span class="n">dt</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">dt</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">tau_var</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_tau_variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">tau_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dt</span> <span class="o">/</span> <span class="n">tau_var</span><span class="p">)</span>
            <span class="c1"># shape = ()</span>
            <span class="k">if</span> <span class="n">tau_var</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">tau_var</span><span class="o">.</span><span class="n">shape</span>
                <span class="k">assert</span> <span class="n">tau_var</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="s2">&quot;The number of tau should equal the number of neurons.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">variable_to_backend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">tau_var</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">membrane_tau_var</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="c1"># TODO: 计划把membrane tau反过来了变成membrane_tau/dt，需要把用的模型也改一下</span>
            <span class="n">membrane_tau_var</span> <span class="o">=</span> <span class="n">dt</span><span class="o">/</span><span class="n">membrane_tau_var</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (1, neuron_num)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variable_to_backend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">membrane_tau_var</span><span class="p">)</span>


        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># add the rule to extend new dimension before shape (for slif model)</span>
            <span class="n">extend_tag</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;\[\d*\]&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extend_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">extend_tag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">extend_tag</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">extend_tag</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">extend_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">extend_tag</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (batch_size, neuron_shape)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variable_to_backend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span>
                    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="s2">&quot;The number of tau should equal the number of neurons.&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span>
                    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="s2">&quot;The number of tau should equal the number of neurons.&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">variable_to_backend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_constant_variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="c1"># if isinstance(var, np.ndarray):</span>
            <span class="c1">#     if var.size &gt; 1:</span>
            <span class="c1">#         shape = var.shape</span>
            <span class="c1">#     else:</span>
            <span class="c1">#         shape = ()</span>
            <span class="c1"># elif isinstance(var, torch.Tensor):</span>
            <span class="c1">#     shape = var.shape</span>
            <span class="c1"># elif hasattr(var, &#39;__iter__&#39;):</span>
            <span class="c1">#     var = np.array(var)</span>
            <span class="c1">#     if var.size &gt; 1:</span>
            <span class="c1">#         shape = var.shape</span>
            <span class="c1">#     else:</span>
            <span class="c1">#         shape = ()</span>
            <span class="c1"># else:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">variable_to_backend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">is_constant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">op_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
            <span class="n">addcode_op</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">op_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">op_count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ind</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">addcode_op</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">addcode_op</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="n">backend</span><span class="o">.</span><span class="n">add_operation</span><span class="p">(</span><span class="n">addcode_op</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">op_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">op_count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="s1">&#39;custom_function&#39;</span>
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ind</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">addcode_op</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">addcode_op</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="n">backend</span><span class="o">.</span><span class="n">register_standalone</span><span class="p">(</span><span class="n">addcode_op</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">addcode_op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">addcode_op</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">op_count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[</span><span class="n">op_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">addcode_op</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_init_operations</span><span class="p">:</span>
            <span class="n">addcode_op</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ind</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">addcode_op</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">addcode_op</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">addcode_op</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">addcode_op</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">addcode_op</span> <span class="o">=</span> <span class="n">addcode_op</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">op_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">backend</span><span class="o">.</span><span class="n">register_initial</span><span class="p">(</span><span class="n">addcode_op</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">addcode_op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">addcode_op</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">op_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">op_count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="s1">&#39;custom_initial_function&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_operations</span><span class="p">[</span><span class="n">op_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">addcode_op</span>



        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">==</span> <span class="s2">&quot;slif&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;selif&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">build</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">backend</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">outlayer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outlayer</span>
            <span class="n">update_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update_op_code</span>
            <span class="n">intital_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">initial_op_code</span>
            <span class="n">backend</span><span class="o">.</span><span class="n">register_initial</span><span class="p">(</span><span class="n">intital_code</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">intital_code</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">intital_code</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">backend</span><span class="o">.</span><span class="n">register_standalone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">update_code</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">update_code</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="n">update_code</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>
            <span class="n">backend</span><span class="o">.</span><span class="n">register_standalone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">return_V</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">backend</span><span class="o">.</span><span class="n">register_standalone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_neuron_label</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">return_S</span><span class="p">,</span> <span class="p">[])</span></div>


<div class="viewcode-block" id="NeuronGroup.custom_model"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronGroup.custom_model">[文档]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">custom_model</span><span class="p">(</span><span class="n">input_vars</span><span class="p">,</span> <span class="n">output_vars</span><span class="p">,</span> <span class="n">new_vars_dict</span><span class="p">,</span> <span class="n">equation_type</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;iterative&#39;</span><span class="p">,</span><span class="s1">&#39;euler_iterative&#39;</span><span class="p">,</span><span class="s1">&#39;exp_euler_iterative&#39;</span><span class="p">,</span><span class="s1">&#39;ode&#39;</span><span class="p">),</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;torch&#39;</span><span class="p">,</span> <span class="n">custom_function_name</span><span class="o">=</span><span class="s1">&#39;custom&#39;</span><span class="p">,</span> <span class="n">base_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_threshold</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Examples:</span>
<span class="sd">            @NeuronGroup.custom_model(input_vars=[&#39;M&#39;, &#39;S&#39;, &#39;WgtSum&#39;], output_vars=[&#39;V&#39;, &#39;M&#39;, &#39;S&#39;],</span>
<span class="sd">            new_vars_dict={&#39;V&#39;:0, &#39;M&#39;:0, &#39;S&#39;:0, &#39;WgtSum&#39;:0}, equation_type=&#39;exp_euler_iterative&#39;)</span>
<span class="sd">            def func(M, S, WgtSum):</span>
<span class="sd">                M = (WgtSum-M)/tau</span>
<span class="sd">                S = (WgtSum-S)/tau</span>
<span class="sd">                V = M - S</span>
<span class="sd">                return V, M, S</span>

<span class="sd">            NeuronGroup(...., neuron_model=func)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span>
        <span class="k">if</span> <span class="n">base_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">NeuronModel</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_model</span><span class="p">,</span> <span class="n">NeuronModel</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">base_model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;base model is given wrong type&quot;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">custom_function_name</span>
        <span class="k">if</span> <span class="n">equation_type</span> <span class="o">==</span> <span class="s1">&#39;iterative&#39;</span> <span class="ow">or</span> <span class="n">equation_type</span> <span class="o">==</span> <span class="s1">&#39;ode&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">new_vars_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;[constant]&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[constant]&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">equation_type</span> <span class="o">==</span> <span class="s1">&#39;euler_iterative&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">new_vars_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;[constant]&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[constant]&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="s1">&#39;tau&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">equation_type</span> <span class="o">==</span> <span class="s1">&#39;exp_euler_iterative&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">new_vars_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;[constant]&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[constant]&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="s1">&#39;tau&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">new_vars_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">new_vars_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_variables</span><span class="p">)</span>
        <span class="n">new_vars_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">)</span>
        <span class="n">new_vars_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">)</span>
        <span class="n">new_vars_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">input_vars</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VariableAgent</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_vars_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;[updated]&#39;</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">new_vars_dict</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The variable </span><span class="si">%s</span><span class="s2"> is not in model variable dict and not a Variable of other modules&quot;</span><span class="o">%</span><span class="n">var</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">output_vars</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VariableAgent</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_vars_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;[updated]&#39;</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">new_vars_dict</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The variable </span><span class="si">%s</span><span class="s2"> is not in model variable dict and not a Variable of other modules&quot;</span><span class="o">%</span><span class="n">var</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="n">op_code</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_vars</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span><span class="n">input_vars</span> <span class="p">]</span>
            <span class="n">model</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op_code</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_threshold</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;V[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">model</span>
        <span class="k">return</span> <span class="n">model_function</span></div></div>




<div class="viewcode-block" id="NeuronModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronModel">[文档]</a><span class="k">class</span> <span class="nc">NeuronModel</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    op -&gt; (return_name, operation_name, input_name1, input_name2...)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#: A dictionary mapping neuron model names to `Model` objects</span>
    <span class="n">neuron_models</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_operations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># self._tau_constant_variables = dict()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># self.neuron_parameters = dict()</span>

<div class="viewcode-block" id="NeuronModel.register"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronModel.register">[文档]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Register a neuron model. Registered neuron models can be referred to</span>
<span class="sd">        # via their name.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            A short name for the state updater (e.g. `&#39;lif&#39;`)</span>
<span class="sd">        model : `NeuronModel`</span>
<span class="sd">            The neuron model object, e.g. an `CLIFModel`, &#39;SLIFModel&#39;.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># only deal with lower case names -- we don&#39;t want to have &#39;LIF&#39; and</span>
        <span class="c1"># &#39;lif&#39;, for example</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">NeuronModel</span><span class="o">.</span><span class="n">neuron_models</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s1">&#39;A neuron_model with the name &quot;</span><span class="si">%s</span><span class="s1">&quot; has already been registered&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">NeuronModel</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s1">&#39;Given model of type </span><span class="si">%s</span><span class="s1"> does not seem to be a valid NeuronModel.&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">))))</span>

        <span class="n">NeuronModel</span><span class="o">.</span><span class="n">neuron_models</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>

<div class="viewcode-block" id="NeuronModel.apply_model"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NeuronModel.apply_model">[文档]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">apply_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_name : str</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NeuronModel</span><span class="o">.</span><span class="n">neuron_models</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s1">&#39;Given model name is not in the model list&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NeuronModel</span><span class="o">.</span><span class="n">neuron_models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span></div></div>

    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def get_var(self):</span>
    <span class="c1">#     NotImplementedError()</span>

    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def get_op(self):</span>
    <span class="c1">#     NotImplementedError()</span>

    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def get_tau(self):</span>
    <span class="c1">#     NotImplementedError()</span>


<div class="viewcode-block" id="CLIFModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.CLIFModel">[文档]</a><span class="k">class</span> <span class="nc">CLIFModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Current LIF 3-kernel model:</span>
<span class="sd">    V(t) = M(t) − S(t) − E(t)</span>
<span class="sd">    I^n[t] = V0 * Isyn^n[t-1] #sum(w * O^(n-1)[t])</span>
<span class="sd">    M^n[t] = betaM * M^n[t-1] + I^n[t-1]</span>
<span class="sd">    S^n[t] = betaS * S^n[t-1] + I^n[t-1]</span>
<span class="sd">    E^n[t] = betaM * E^n[t-1] + Vth * O^n[t-1]</span>
<span class="sd">    O^n[t] = spike_func(V^n[t-1])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CLIFModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_p&#39;] = kwargs.get(&#39;tau_p&#39;, 12.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_q&#39;] = kwargs.get(&#39;tau_q&#39;, 8.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_m&#39;] = kwargs.get(&#39;tau_m&#39;, 20.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_th&#39;] = kwargs.get(&#39;v_th&#39;, 1.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># self._variables[&#39;I_che&#39;] = 0.0</span>
        <span class="c1"># self._variables[&#39;I_ele&#39;] = 0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_m&#39;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">))</span>  <span class="c1"># self.neuron_parameters[&#39;tau_m&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_p&#39;</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">))</span>  <span class="c1"># self.neuron_parameters[&#39;tau_p&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauQ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_q&#39;</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">))</span>  <span class="c1"># self.neuron_parameters[&#39;tau_q&#39;]</span>

        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauP&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauQ&#39;</span><span class="p">]</span>
        <span class="n">V0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta</span> <span class="o">**</span> <span class="p">(</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;V0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># self._operations.append((&#39;I_che&#39;, &#39;var_mult&#39;, &#39;V0&#39;, &#39;WgtSum[updated]&#39;))</span>
        <span class="c1"># self._operations.append((&#39;I&#39;, &#39;add&#39;, &#39;I_che[updated]&#39;, &#39;I_ele&#39;))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;V0&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauP&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;I[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauQ&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;I[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;PSP&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;M[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;S[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;PSP&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;V[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauM&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting&#39;</span><span class="p">))</span></div>

<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;clif&quot;</span><span class="p">,</span> <span class="n">CLIFModel</span><span class="p">)</span>


<div class="viewcode-block" id="IFModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.IFModel">[文档]</a><span class="k">class</span> <span class="nc">IFModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    IF model:</span>
<span class="sd">    V(t) = V(t-1) * (1 - O(t-1)) + Isyn[t] - ConstantDecay</span>

<span class="sd">    O^n[t] = spike_func(V^n[t-1])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IFModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># self.neuron_parameters[&#39;ConstantDecay&#39;] = kwargs.get(&#39;ConstantDecay&#39;, 0.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_th&#39;] = kwargs.get(&#39;v_th&#39;, 1.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;ConstantDecay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConstantDecay&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp1&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;ConstantDecay&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp1&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp1&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp1&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting&#39;</span><span class="p">))</span></div>

<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;if&quot;</span><span class="p">,</span> <span class="n">IFModel</span><span class="p">)</span>

<div class="viewcode-block" id="NullModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NullModel">[文档]</a><span class="k">class</span> <span class="nc">NullModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return &#39;O&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NullModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># self.neuron_parameters[&#39;ConstantDecay&#39;] = kwargs.get(&#39;ConstantDecay&#39;, 0.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_th&#39;] = kwargs.get(&#39;v_th&#39;, 1.0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;assign&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn[updated]&#39;</span><span class="p">))</span></div>

<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="n">NullModel</span><span class="p">)</span>



<span class="kn">import</span> <span class="nn">torch</span>


<div class="viewcode-block" id="QLIFModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.QLIFModel">[文档]</a><span class="k">class</span> <span class="nc">QLIFModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    LIF neuron model for Q-Backprop learning</span>

<span class="sd">    E[t] = beta_m*E[t-1] + Vth*O[t-1]</span>
<span class="sd">    V[t] = WgtSum(PSP[t]) - E[t]</span>
<span class="sd">    O[t] = spike_function(V[t])</span>


<span class="sd">    # Q for non-spiking</span>
<span class="sd">    Mp[t] = beta_m*Mp[t-1] + WpSum[t]</span>
<span class="sd">    Sp[t] = beta_s*Sp[t-1] + WpSum[t]</span>
<span class="sd">    P[t] = Mp[t] - Sp[t]</span>

<span class="sd">    # Q for spiking</span>
<span class="sd">    Mq[t] = beta_m*Mq[t-1] + WqSum[t]</span>
<span class="sd">    Sq[t] = beta_s*Sq[t-1] + WqSum[t]</span>
<span class="sd">    Q[t] = Mq[t] - Sq[t]</span>

<span class="sd">    R[t] = ~O[t]*beta_s*R[t-1] + O[t]</span>
<span class="sd">    F[t] = 1 - R[t]</span>
<span class="sd">    QP[t] = Q[t] - P[t]</span>
<span class="sd">    BQ[t] = R[t]*Q[t] + F[t]*P[t]</span>

<span class="sd">    TP[t] = R[t]*P[t] + F[t]*Reward - P[t-1]</span>
<span class="sd">    TQ[t] = F[t]*Q[t] + R[t]*Reward - Q[t-1]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># WgtSum(BQ_post[t - 1]) / WgtSum)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QLIFModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;Beta_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_m&#39;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;Beta_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_s&#39;</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;One&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Mp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Sp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Mq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Sq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;QP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;BQ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;TQ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;PSP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;WpSum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;WqSum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Reward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta_m&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;SumPSP&#39;</span><span class="p">,</span> <span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;PSP&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;SumPSP&#39;</span><span class="p">,</span> <span class="s1">&#39;E[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Mp&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta_m&#39;</span><span class="p">,</span> <span class="s1">&#39;Mp&#39;</span><span class="p">,</span> <span class="s1">&#39;WpSum&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Sp&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta_s&#39;</span><span class="p">,</span> <span class="s1">&#39;Sp&#39;</span><span class="p">,</span> <span class="s1">&#39;WpSum&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mp[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Sp[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Mq&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta_m&#39;</span><span class="p">,</span> <span class="s1">&#39;Mq&#39;</span><span class="p">,</span> <span class="s1">&#39;WpSum&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Sq&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta_s&#39;</span><span class="p">,</span> <span class="s1">&#39;Sq&#39;</span><span class="p">,</span> <span class="s1">&#39;WpSum&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mq[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Sq[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;RTmp&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta_s&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta_s&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">))</span></div>



<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;qlif&quot;</span><span class="p">,</span> <span class="n">QLIFModel</span><span class="p">)</span>



<div class="viewcode-block" id="SELIFDebugModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.SELIFDebugModel">[文档]</a><span class="k">class</span> <span class="nc">SELIFDebugModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">tau_m</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">tau_p</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span><span class="n">tau_q</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span><span class="n">v_th</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">outlayer</span><span class="o">=</span><span class="kc">False</span>
                 <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SELIFDebugModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">spaic.Learning.TRUE_Learner</span> <span class="kn">import</span> <span class="n">TRUE_SpikeProp</span>
        <span class="c1"># initial value for state variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;[2]O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;dV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;WgtSum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;cumV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_m</span> <span class="o">=</span> <span class="n">tau_m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span> <span class="o">=</span> <span class="n">tau_p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_s</span> <span class="o">=</span> <span class="n">tau_q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_th</span> <span class="o">=</span> <span class="n">v_th</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_reset</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">v_th</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outlayer</span> <span class="o">=</span> <span class="n">outlayer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">tau_m</span> <span class="o">/</span> <span class="n">tau_q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">update_op_code</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;[2]O&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="s1">&#39;WgtSum[updated]&#39;</span><span class="p">)</span>  <span class="c1"># &#39;WgtSum[updated]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_op_code</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_V</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_op_code</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">,</span> <span class="p">[])</span>

<div class="viewcode-block" id="SELIFDebugModel.attach_learner"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.SELIFDebugModel.attach_learner">[文档]</a>    <span class="k">def</span> <span class="nf">attach_learner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">learner</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learner</span> <span class="o">=</span> <span class="n">learner</span></div>

<div class="viewcode-block" id="SELIFDebugModel.build"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.SELIFDebugModel.build">[文档]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M_initial</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S_initial</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_initial</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">backend</span><span class="o">.</span><span class="n">dt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">backend</span><span class="o">.</span><span class="n">dt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">backend</span><span class="o">.</span><span class="n">dt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_E</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="SELIFDebugModel.initial"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.SELIFDebugModel.initial">[文档]</a>    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_initial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_initial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_initial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cumV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_initial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">O</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_E</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="SELIFDebugModel.update"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.SELIFDebugModel.update">[文档]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">WgtSum</span><span class="p">):</span>

        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V0</span> <span class="o">*</span> <span class="n">WgtSum</span>

        <span class="k">if</span> <span class="n">I</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Ii</span> <span class="o">=</span> <span class="n">I</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
            <span class="n">I0</span> <span class="o">=</span> <span class="n">I</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ii</span> <span class="o">-</span> <span class="n">I0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ii</span> <span class="o">-</span> <span class="n">I0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">+</span> <span class="n">I</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">+</span> <span class="n">I</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">O</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Oi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">O</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="c1">#+ 0.9*self.O[:, 0, ...].detach()  # *self.O[:, 0, ...].gt(0.0)</span>
            <span class="n">Ot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">O</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="c1">#+ 0.9*self.O[:, 1, ...].detach()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Oi</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">Ot</span> <span class="o">=</span> <span class="mf">0.0</span>


        <span class="c1"># expv = torch.clamp_max(torch.exp(2.5 * self.V)-1, 12)</span>
        <span class="n">expv</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">v_th</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dV</span> <span class="o">=</span> <span class="p">(</span><span class="n">expv</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dV</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_reset</span><span class="o">*</span><span class="p">(</span><span class="n">Oi</span><span class="o">-</span><span class="n">Ot</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_m</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">O</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learner</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_th</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">O</span></div>

<div class="viewcode-block" id="SELIFDebugModel.return_V"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.SELIFDebugModel.return_V">[文档]</a>    <span class="k">def</span> <span class="nf">return_V</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span></div></div>

<div class="viewcode-block" id="LIFModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.LIFModel">[文档]</a><span class="k">class</span> <span class="nc">LIFModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    LIF model:</span>
<span class="sd">    # V(t) = tuaM * V^n[t-1] + Isyn[t]   # tauM: constant membrane time (tauM=RmCm)</span>
<span class="sd">    O^n[t] = spike_func(V^n[t-1])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LIFModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># initial value for state variables</span>

        <span class="c1"># self.neuron_parameters[&#39;tau_m&#39;] = kwargs.get(&#39;tau_m&#39;, 20.0)  # 20</span>
        <span class="c1"># self.neuron_parameters[&#39;v_th&#39;] = kwargs.get(&#39;v_th&#39;, 1)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_reset&#39;] = kwargs.get(&#39;v_reset&#39;, 0.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># self._variables[&#39;b&#39;] = 0.0</span>
        <span class="c1"># self._variables[&#39;I_che&#39;] = 0.0</span>
        <span class="c1"># self._variables[&#39;I_ele&#39;] = 0.0</span>
        <span class="c1"># self._variables[&#39;I&#39;] = 0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Vreset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_reset&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_m&#39;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauM&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span>  <span class="s1">&#39;O&#39;</span><span class="p">))</span></div>
        <span class="c1"># self._operations.append((&#39;Resetting&#39;, &#39;var_mult&#39;, &#39;Vtemp&#39;, &#39;O[updated]&#39;))</span>
        <span class="c1"># self._operations.append((&#39;V&#39;, &#39;minus&#39;, &#39;Vtemp&#39;, &#39;Resetting&#39;))</span>

<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;lif&quot;</span><span class="p">,</span> <span class="n">LIFModel</span><span class="p">)</span>


<span class="c1"># class linearDecayLIFModel(NeuronModel):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     LIF model:</span>
<span class="c1">#     # V(t) = tuaM * V^n[t-1] + Isyn[t]   # tauM: constant membrane time (tauM=RmCm)</span>
<span class="c1">#     O^n[t] = spike_func(V^n[t-1])</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#     def __init__(self, **kwargs):</span>
<span class="c1">#         super(ConstantDecayLIFModel, self).__init__()</span>
<span class="c1">#         # initial value for state variables</span>
<span class="c1">#         self._variables[&#39;V&#39;] = 0.0</span>
<span class="c1">#         self._variables[&#39;O&#39;] = 0.0</span>
<span class="c1">#         self._variables[&#39;Isyn&#39;] = 0.0</span>
<span class="c1">#</span>
<span class="c1">#         self._parameter_variables[&#39;Vth&#39;] = kwargs.get(&#39;v_th&#39;, 1)</span>
<span class="c1">#         self._constant_variables[&#39;Vreset&#39;] = kwargs.get(&#39;v_reset&#39;, 0.0)</span>
<span class="c1">#         self._constant_variables[&#39;Vdecay&#39;] = kwargs.get(&#39;v_decay&#39;, 1.0)</span>
<span class="c1">#</span>
<span class="c1">#         self._operations.append((&#39;Vtemp&#39;, &#39;var_linear&#39;, &#39;tauM&#39;, &#39;V&#39;, &#39;Isyn[updated]&#39;))</span>
<span class="c1">#         self._operations.append((&#39;O&#39;, &#39;threshold&#39;, &#39;Vtemp&#39;, &#39;Vth&#39;))</span>
<span class="c1">#         self._operations.append((&#39;Resetting&#39;, &#39;var_mult&#39;, &#39;Vtemp&#39;, &#39;O[updated]&#39;))</span>
<span class="c1">#         self._operations.append((&#39;V&#39;, &#39;minus&#39;, &#39;Vtemp&#39;, &#39;Resetting&#39;))</span>
<span class="c1">#</span>
<span class="c1"># NeuronModel.register(&quot;constantdecaylif&quot;, ConstantDecayLIFModel)</span>

<div class="viewcode-block" id="ConstantCurrentLIFModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.ConstantCurrentLIFModel">[文档]</a><span class="k">class</span> <span class="nc">ConstantCurrentLIFModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ConstantCurrentLIF model:</span>
<span class="sd">    V(t) = V^n[t-1] + (dt/taum) * (Ureset-V^n[t-1]+I)  # tauM: constant membrane time (tauM=RmCm)  Isyn = I*Weight</span>
<span class="sd">    O^n[t] = spike_func(V^n[t-1])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConstantCurrentLIFModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># initial value for state variables</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_m&#39;] = kwargs.get(&#39;tau_m&#39;, 20.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_th&#39;] = kwargs.get(&#39;v_th&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_reset&#39;] = kwargs.get(&#39;v_reset&#39;, 0.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># beta = self.neuron_parameters[&#39;tau_p&#39;] / self.neuron_parameters[&#39;tau_q&#39;]</span>
        <span class="c1"># V0 = 1.0  # (1 / (beta - 1)) * (beta ** (beta / (beta - 1)))</span>
        <span class="c1"># self._constant_variables[&#39;V0&#39;] = V0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Vreset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_reset&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tauM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_m&#39;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>

        <span class="c1"># self._operations.append((&#39;I&#39;, &#39;var_mult&#39;, &#39;V0&#39;, &#39;I_synapse&#39;))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;decayV&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauM&#39;</span><span class="p">,</span> <span class="s1">&#39;decayV&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting&#39;</span><span class="p">))</span></div>

<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;constantcurrentlif&quot;</span><span class="p">,</span> <span class="n">ConstantCurrentLIFModel</span><span class="p">)</span>


<div class="viewcode-block" id="NonSpikingLIFModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.NonSpikingLIFModel">[文档]</a><span class="k">class</span> <span class="nc">NonSpikingLIFModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NonSpikingLIF model:</span>
<span class="sd">    # V(t) = -tuaM * V^n[t-1] + M^n[t] - S^n[t]   # tauM: constant membrane time (tauM=RmCm)</span>
<span class="sd">    V(t) = V^n[t-1] + (dt/taum) * (PSP-V^n[t-1])  # tauM: constant membrane time (tauM=RmCm)</span>
<span class="sd">    I^n[t] = V0 * Isyn^n[t-1]                # sum(w * O^(n-1)[t])</span>
<span class="sd">    M^n[t] = tauP * M^n[t-1] + I^n[t-1]        # tauP: decaying time constants of membrane integration</span>
<span class="sd">    S^n[t] = tauQ * S^n[t-1] + I^n[t-1]        # tauQ: decaying time constants of synaptic currents</span>
<span class="sd">    PSP = M - S</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NonSpikingLIFModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># initial value for state variables</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_p&#39;] = kwargs.get(&#39;tau_p&#39;, 4.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_q&#39;] = kwargs.get(&#39;tau_q&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_m&#39;] = kwargs.get(&#39;tau_m&#39;, 1.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_p&#39;</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauQ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_q&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauP&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauQ&#39;</span><span class="p">]</span>
        <span class="n">V0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta</span> <span class="o">**</span> <span class="p">(</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;V0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tauM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_m&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># self._tau_constant_variables[&#39;tauM&#39;] = kwargs.get(&#39;tau_m&#39;, 1.0)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;V0&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauP&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauQ&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;PSP&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;decayV&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;PSP&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauM&#39;</span><span class="p">,</span> <span class="s1">&#39;decayV&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">))</span></div>


<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;nonspikinglif&quot;</span><span class="p">,</span> <span class="n">NonSpikingLIFModel</span><span class="p">)</span>

<div class="viewcode-block" id="LIFMModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.LIFMModel">[文档]</a><span class="k">class</span> <span class="nc">LIFMModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    LIF model:</span>
<span class="sd">    # I_che = tauP*I + Isyn^n[t-1] + b^n                         # sum(w * O^(n-1)[t])</span>
<span class="sd">    # I = I_che + I_ele</span>
<span class="sd">    # F = tauM * exp(-O^n[t-1] / tauM)</span>
<span class="sd">    # V(t) = V^n[t-1] * F + I</span>
<span class="sd">    # O^(n)[t] = spike_func(V^n(t))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LIFMModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># initial value for state variables</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_p&#39;] = kwargs.get(&#39;tau_p&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_m&#39;] = kwargs.get(&#39;tau_m&#39;, 10.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_th&#39;]  = kwargs.get(&#39;v_th&#39;, 1.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># self._variables[&#39;b&#39;] = 0.0</span>
        <span class="c1"># self._variables[&#39;I_che&#39;] = 0.0</span>
        <span class="c1"># self._variables[&#39;I_ele&#39;] = 0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># self._constant_variables[&#39;Vreset&#39;] = v_reset</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_m&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_p&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauP&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn[updated]&#39;</span><span class="p">))</span>

        <span class="c1"># self._operations.append((&#39;I_che&#39;, &#39;var_linear&#39;, &#39;tauP&#39;, &#39;I_che&#39;, &#39;PSP&#39;))</span>
        <span class="c1"># self._operations.append((&#39;I&#39;, &#39;add&#39;, &#39;I_che[updated]&#39;, &#39;I_ele&#39;))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;tauM&#39;</span><span class="p">,</span> <span class="s1">&#39;I[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vreset&#39;</span><span class="p">))</span></div>

<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;lifm&quot;</span><span class="p">,</span> <span class="n">LIFMModel</span><span class="p">)</span>

<div class="viewcode-block" id="IZHModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.IZHModel">[文档]</a><span class="k">class</span> <span class="nc">IZHModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    IZH model:</span>
<span class="sd">    V = V + dt / tauM * (C1 * V * V + C2 * V + C3 - U + PSP)  # tauM=1 此处加tauM是为了添加op时和LIF模型保存一致</span>
<span class="sd">    V = V + dt / tauM * (V* (C1 * V + C2) + C3 - U + PSP)     # 由上式拆分而来</span>
<span class="sd">    U = U + a. * (b. * V - U)</span>
<span class="sd">    PSP = M^n[t] - S^n[t]</span>
<span class="sd">    M^n[t] = tauP * M^n[t-1] + I^n[t-1]        # tauP: decaying time constants of membrane integration</span>
<span class="sd">    S^n[t] = tauQ * S^n[t-1] + I^n[t-1]        # tauQ: decaying time constants of synaptic currents</span>
<span class="sd">    I^n[t] = V0 * Isyn^n[t-1]                # Isyn = sum(w * O^(n-1)[t])</span>
<span class="sd">    O^n[t] = spike_func(V^n[t-1])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IZHModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># initial value for state variables</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_p&#39;] = kwargs.get(&#39;tau_p&#39;, 4.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_q&#39;] = kwargs.get(&#39;tau_q&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;a&#39;] = kwargs.get(&#39;a&#39;, 0.02)</span>
        <span class="c1"># self.neuron_parameters[&#39;b&#39;] = kwargs.get(&#39;b&#39;, 0.2)</span>
        <span class="c1"># self.neuron_parameters[&#39;Vrest&#39;] = kwargs.get(&#39;Vrest&#39;, -65.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;Ureset&#39;] = kwargs.get(&#39;Ureset&#39;, 8.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">65.0</span>  <span class="c1"># self.neuron_parameters[&#39;c&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># self.neuron_parameters[&#39;b&#39;]*self._variables[&#39;V&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># 1.8</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_p&#39;</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauQ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_q&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauP&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauQ&#39;</span><span class="p">]</span>
        <span class="n">V0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta</span> <span class="o">**</span> <span class="p">(</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;V0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span><span class="c1"># 30.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vreset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Vrest&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">65.0</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span>   <span class="c1"># 为了发放后将电压重置为-65</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Ureset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ureset&#39;</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">)</span>  <span class="c1"># 8.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;C1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.04</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;C2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">140</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tauM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>



        <span class="c1"># V = V + dt / tauM * (C1 * V * V + C2 * V + C3 - U + PSP)</span>
        <span class="c1"># V = V + dt / tauM * (V* (C1 * V + C2) + C3 - U + PSP)</span>
        <span class="c1"># U = U + dt /tauM * a. * (b. * V - U)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;V0&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauP&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;I[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauQ&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;I[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;PSP&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;M[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;S[updated]&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;VResetting&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;VResetting&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;UResetting&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Ureset&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Utemp&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;UResetting&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_V1&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;C2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_V2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_V1&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;C3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_V3&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_V2&#39;</span><span class="p">,</span> <span class="s1">&#39;Utemp&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_V4&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_V3&#39;</span><span class="p">,</span> <span class="s1">&#39;PSP&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauM&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_V4&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_U1&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_U2&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_U1&#39;</span><span class="p">,</span> <span class="s1">&#39;Utemp&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_U2&#39;</span><span class="p">,</span> <span class="s1">&#39;Utemp&#39;</span><span class="p">))</span></div>

        <span class="c1"># self._operations.append((&#39;V&#39;, &#39;izh_v&#39;, &#39;V&#39;, &#39;U&#39;, &#39;PSP&#39;))</span>
        <span class="c1"># self._operations.append((&#39;U&#39;, &#39;izh_u&#39;, &#39;a&#39;, &#39;b&#39;, &#39;V[updated]&#39;, &#39;U&#39;))</span>

<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;izh&quot;</span><span class="p">,</span> <span class="n">IZHModel</span><span class="p">)</span>

<div class="viewcode-block" id="aEIFModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.aEIFModel">[文档]</a><span class="k">class</span> <span class="nc">aEIFModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    aEIF model:</span>

<span class="sd">    V = V + dt / tauM * (EL - V + EXP - U + I^n[t])</span>
<span class="sd">    U = U + dt / tauW * (a * (V - EL) - U)</span>
<span class="sd">    EXP = delta_t * delta_t2 * exp(du_th/delta_t2)</span>
<span class="sd">    du = V - EL</span>
<span class="sd">    du_th = V - Vth</span>
<span class="sd">    I^n[t] = V0 * Isyn^n[t-1]</span>

<span class="sd">    O^n[t] = spike_func(V^n[t-1])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">aEIFModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># initial value for state variables</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_p&#39;]   = kwargs.get(&#39;tau_p&#39;, 12.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_q&#39;]   = kwargs.get(&#39;tau_q&#39;, 4.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_w&#39;]   = kwargs.get(&#39;tau_w&#39;, 144)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_m&#39;]   = kwargs.get(&#39;tau_m&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;a&#39;]       = kwargs.get(&#39;a&#39;, 0.05)</span>
        <span class="c1"># self.neuron_parameters[&#39;b&#39;]       = kwargs.get(&#39;b&#39;, 0.0805)</span>
        <span class="c1"># self.neuron_parameters[&#39;delta_t&#39;] = kwargs.get(&#39;delta_t&#39;, 30.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;delta_t2&#39;] = kwargs.get(&#39;delta_t2&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;EL&#39;]      = kwargs.get(&#39;EL&#39;, -70.6)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I_che&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I_ele&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">70.6</span>
        <span class="c1"># self._variables[&#39;Vt&#39;] = -70.6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># self.neuron_parameters[&#39;b&#39;] * (-70.6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;EXP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_p&#39;</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_q&#39;</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">))</span>
        <span class="n">V0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">beta</span> <span class="o">**</span> <span class="p">(</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;V0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;EL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;EL&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">70.6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mf">0.0805</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">50.4</span><span class="p">)</span>
        <span class="c1"># self._constant_variables[&#39;Ureset&#39;] = -8.0</span>
        <span class="c1"># self._constant_variables[&#39;C1&#39;] = 0.6</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;delta_t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delta_t&#39;</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delta_t2&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;delta_t2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delta_t2&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># *10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tauM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_m&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tauW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_w&#39;</span><span class="p">,</span> <span class="mi">144</span><span class="p">)</span>

        <span class="c1"># V = V + dt / tauM * (EL - V + EXP - U + I ^ n[t])</span>
        <span class="c1"># U = U + dt / tauW * (a * (V - EL) - U)</span>
        <span class="c1"># EXP = delta_t * exp(du_th / delta_t2)</span>
        <span class="c1"># du = V - EL</span>
        <span class="c1"># du_th = V - Vth</span>
        <span class="c1"># I ^ n[t] = V0 * WgtSum ^ n[t - 1]</span>
        <span class="c1">#</span>
        <span class="c1"># O ^ n[t] = spike_func(V ^ n[t - 1])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;V0&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn[updated]&#39;</span><span class="p">))</span>
        <span class="c1"># self._operations.append((&#39;I&#39;, &#39;add&#39;, &#39;I_che[updated]&#39;, &#39;I_ele[updated]&#39;))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;dv&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;EL&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;dv_th&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;EXP_T1&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;dv_th&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;EXP_T2&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;EXP_T1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;EXP&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t&#39;</span><span class="p">,</span> <span class="s1">&#39;EXP_T2&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_V1&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;EXP[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;dv&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_V2&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_V1&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_V3&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_V2&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vt&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauM&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_V3&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_U1&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;dv&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_U2&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_U1&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Ut&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauW&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_U2&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Vt&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vt&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp3&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vt&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;EL&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Ut&#39;</span><span class="p">))</span></div>


<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;aeif&quot;</span><span class="p">,</span> <span class="n">aEIFModel</span><span class="p">)</span>
<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;adex&quot;</span><span class="p">,</span> <span class="n">aEIFModel</span><span class="p">)</span>


<div class="viewcode-block" id="GLIFModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.GLIFModel">[文档]</a><span class="k">class</span> <span class="nc">GLIFModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Current GLIF5 model:</span>

<span class="sd">    V = V + dt/tau_m * (R * (I + I1 + I2) - (V - E_L))</span>
<span class="sd">    Theta_s = Theta_s - b_s * Theta_s</span>
<span class="sd">    I_j = I_j - k_j * I_j (j = 1, 2)</span>
<span class="sd">    Theta_v = Theta_v + a_v * (V - E_L) - b_v * Theta_v</span>
<span class="sd">    v_th = Theta_v + Theta_s + Theta_inf</span>
<span class="sd">    O = spike_func(V)</span>

<span class="sd">    Reset function:</span>

<span class="sd">    V = E_L + f_v * (V - E_L) - delta_v</span>
<span class="sd">    Theta_s = Theta_s + delta_Theta_s</span>
<span class="sd">    I_j = f_j * I_j + delta_I_j (j = 1, 2; f_j = 1)</span>
<span class="sd">    Theta_v = Theta_v</span>

<span class="sd">    After transform:</span>
<span class="sd">    part I:</span>
<span class="sd">    I^n[t] = tau_p * I + Isyn^n[t-1]</span>
<span class="sd">    I_sum = I1 + I2</span>
<span class="sd">    I_sum = I_sum + I^n[t]</span>
<span class="sd">    S^n[t] = tau_q * S^n[t-1] + I_sum</span>

<span class="sd">    dv = V^n[t-1] - E_L</span>
<span class="sd">    decay = S^n[t] - dv</span>
<span class="sd">    V = tauM * decay + V</span>

<span class="sd">    Theta_s = (-b_s) * Theta_s + Theta_s</span>
<span class="sd">    I_j = (-k_j) * I_j + I_j</span>
<span class="sd">    Theta_temp = a_v * dv + Theta_v</span>
<span class="sd">    Theta_v = (-b_v) * Theta_v + Theta_temp</span>
<span class="sd">    Theta = Theta_v + Theta_s</span>
<span class="sd">    v_th = Theta + Theta_inf</span>
<span class="sd">    O = spike_func(V, v_th)</span>

<span class="sd">    part II(reset part):</span>
<span class="sd">    dv_reset = V^n[t] - E_L</span>
<span class="sd">    deltaV(constant) = E_L - delta_v</span>
<span class="sd">    Vreset = f_v * dv_reset + deltaV</span>
<span class="sd">    Vreset = Vreset - V</span>

<span class="sd">    V = Vreset * O + V</span>
<span class="sd">    Theta_s = Theta_s + delta_Theta_s * O</span>
<span class="sd">    I_j = I_j + delta_I_j * O</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GLIFModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># self.neuron_parameters[&#39;R&#39;]             = kwargs.get(&#39;R&#39;, 0.2)</span>
        <span class="c1"># self.neuron_parameters[&#39;C&#39;]             = kwargs.get(&#39;C&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;E_L&#39;]           = kwargs.get(&#39;E_L&#39;, 0.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;Theta_inf&#39;]     = kwargs.get(&#39;Theta_inf&#39;, 1.0)</span>
        <span class="c1"># # self.neuron_parameters[&#39;delta_t&#39;]       = kwargs.get(&#39;delta_t&#39;, 0.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;f_v&#39;]           = kwargs.get(&#39;f_v&#39;, 0.1)</span>
        <span class="c1"># self.neuron_parameters[&#39;delta_v&#39;]       = kwargs.get(&#39;delta_v&#39;, 0.05)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_s&#39;]           = -kwargs.get(&#39;b_s&#39;, 0.02)</span>
        <span class="c1"># self.neuron_parameters[&#39;delta_Theta_s&#39;] = kwargs.get(&#39;delta_Theta_s&#39;, 0.02)</span>
        <span class="c1"># self.neuron_parameters[&#39;k_1&#39;]           = -kwargs.get(&#39;k_1&#39;, 0.1)</span>
        <span class="c1"># self.neuron_parameters[&#39;k_2&#39;]           = -kwargs.get(&#39;k_2&#39;, 0.1)</span>
        <span class="c1"># self.neuron_parameters[&#39;delta_I1&#39;]      = kwargs.get(&#39;delta_I1&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;delta_I2&#39;]      = kwargs.get(&#39;delta_I2&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_v&#39;]           = kwargs.get(&#39;a_v&#39;, 0.05)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_v&#39;]           = -kwargs.get(&#39;b_v&#39;, 0.1)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_p&#39;]         = kwargs.get(&#39;tau_p&#39;, 1.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;tau_q&#39;]         = kwargs.get(&#39;tau_q&#39;, 1.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Theta_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Theta_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I1&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="mf">0.08</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I2&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="mf">0.12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;v_th&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;deltaV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;E_L&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delta_v&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;E_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;E_L&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Theta_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Theta_inf&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;f_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f_v&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;delta_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delta_v&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b_s&#39;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;delta_Theta_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delta_Theta_s&#39;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;k_1&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;k_2&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;delta_I1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delta_I1&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;delta_I2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delta_I2&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a_v&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b_v&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tau_m&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauP&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_p&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_variables</span><span class="p">[</span><span class="s1">&#39;tauQ&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau_q&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># self._tau_constant_variables[&#39;k1&#39;]      = self.neuron_parameters[&#39;k_1&#39;]</span>
        <span class="c1"># self._tau_constant_variables[&#39;k2&#39;]      = self.neuron_parameters[&#39;k_2&#39;]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauP&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;I1&#39;</span><span class="p">,</span> <span class="s1">&#39;I2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;I_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;I[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tauQ&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;I_sum&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;dv&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;E_L&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;decay&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;S[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;dv&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vt&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tau_m&#39;</span><span class="p">,</span> <span class="s1">&#39;decay&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Theta_st&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;b_s&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta_s&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta_s&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I1t&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;k1&#39;</span><span class="p">,</span> <span class="s1">&#39;I1&#39;</span><span class="p">,</span> <span class="s1">&#39;I1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I2t&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;k2&#39;</span><span class="p">,</span> <span class="s1">&#39;I2&#39;</span><span class="p">,</span> <span class="s1">&#39;I2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Theta_temp&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;a_v&#39;</span><span class="p">,</span> <span class="s1">&#39;dv&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta_v&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Theta_v&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;b_v&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta_v&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta_temp&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Theta&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta_v[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta_st&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta_inf&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Vt&#39;</span><span class="p">,</span> <span class="s1">&#39;v_th[updated]&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I1&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_I1&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;I1t&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;I2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_I2&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;I2t&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Theta_s&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_Theta_s&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Theta_st&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;dv_reset&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vt&#39;</span><span class="p">,</span> <span class="s1">&#39;E_L&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;f_v&#39;</span><span class="p">,</span> <span class="s1">&#39;dv_reset&#39;</span><span class="p">,</span> <span class="s1">&#39;deltaV&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;E_L&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;Vt&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Vt&#39;</span><span class="p">))</span></div>


<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;glif&quot;</span><span class="p">,</span> <span class="n">GLIFModel</span><span class="p">)</span>


<div class="viewcode-block" id="HodgkinHuxleyModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.HodgkinHuxleyModel">[文档]</a><span class="k">class</span> <span class="nc">HodgkinHuxleyModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hodgkin-Huxley model:</span>

<span class="sd">    V = V + dt/tau_v * (I - Ik)</span>
<span class="sd">    Ik = NA + K + L</span>
<span class="sd">    NA = g_NA * m^3 * h * (V - V_NA)</span>
<span class="sd">    K = g_K * n^4 * (V - V_K)</span>
<span class="sd">    L = g_L * (V - V_L)</span>

<span class="sd">    m = m + dt/tau_m * (alpha_m * (1-m) - beta_m * m)</span>
<span class="sd">    n = n + dt/tau_n * (alpha_n * (1-n) - beta_n * n)</span>
<span class="sd">    h = h + dt/tau_h * (alpha_h * (1-h) - beta_h * h)</span>

<span class="sd">    original function:</span>
<span class="sd">    alpha_m = 0.1 * (-V + 25) / (exp((-V+25)/10) - 1)</span>
<span class="sd">    beta_m = 4 * exp(-V/18)</span>
<span class="sd">    alpha_n = 0.01 * (-V + 10) / (exp((-V+10)/10) - 1)</span>
<span class="sd">    beta_n = 0.125 * exp(-V/80)</span>
<span class="sd">    alpha_h = 0.07 * exp(-V/20)</span>
<span class="sd">    beta_h = 1/(exp((-V+30)/10) + 1)</span>

<span class="sd">    O^n[t] = spike_func(V^n[t-1])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HodgkinHuxleyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># initial value for state variables</span>
        <span class="c1"># self.neuron_parameters[&#39;dt&#39;] = kwargs.get(&#39;dt&#39;, 0.1)</span>
        <span class="c1">#</span>
        <span class="c1"># self.neuron_parameters[&#39;g_NA&#39;] = kwargs.get(&#39;g_NA&#39;, 120.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;g_K&#39;] = kwargs.get(&#39;g_K&#39;, 36.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;g_L&#39;] = kwargs.get(&#39;g_L&#39;, 0.3)</span>
        <span class="c1">#</span>
        <span class="c1"># self.neuron_parameters[&#39;E_NA&#39;]      = kwargs.get(&#39;E_NA&#39;, 120.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;E_K&#39;]      = kwargs.get(&#39;E_K&#39;, -12.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;E_L&#39;]      = kwargs.get(&#39;E_L&#39;, 10.6)</span>
        <span class="c1">#</span>
        <span class="c1"># # a_m = a_m1 * (-V + a_m2) / (exp((-V + a_m2) / a_m3 - 1)</span>
        <span class="c1"># # b_m = b_m1 * exp((-V + b_m2) / b_m3)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_m1&#39;] = kwargs.get(&#39;alpha_m1&#39;, 0.1)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_m2&#39;] = kwargs.get(&#39;alpha_m2&#39;, 25.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_m3&#39;] = kwargs.get(&#39;alpha_m3&#39;, 10.0)</span>
        <span class="c1"># # self.neuron_parameters[&#39;a_m4&#39;] = kwargs.get(&#39;alpha_m4&#39;, -1)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_m1&#39;] = kwargs.get(&#39;beta_m1&#39;, 4.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_m2&#39;] = kwargs.get(&#39;beta_m2&#39;, 0.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_m3&#39;] = kwargs.get(&#39;beta_m3&#39;, 18.0)</span>
        <span class="c1">#</span>
        <span class="c1"># # a_n = a_n1 * (-V + a_n2) / (exp((-V + a_n2) / a_n3 - 1)</span>
        <span class="c1"># # b_n = b_n1 * exp((-V + b_n2) / b_n3)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_n1&#39;] = kwargs.get(&#39;alpha_n1&#39;, 0.01)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_n2&#39;] = kwargs.get(&#39;alpha_n2&#39;, 10.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_n3&#39;] = kwargs.get(&#39;alpha_n3&#39;, 10.0)</span>
        <span class="c1"># # self.neuron_parameters[&#39;a_n4&#39;] = kwargs.get(&#39;alpha_n4&#39;, -1)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_n1&#39;] = kwargs.get(&#39;beta_n1&#39;, 0.125)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_n2&#39;] = kwargs.get(&#39;beta_n2&#39;, 0.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_n3&#39;] = kwargs.get(&#39;beta_n3&#39;, 80.0)</span>
        <span class="c1">#</span>
        <span class="c1"># # a_h = a_h1 * exp((-V + a_h2) / a_h3)</span>
        <span class="c1"># # b_h = b_h1 / (exp((-V + b_h2) / b_h3 + 1)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_h1&#39;] = kwargs.get(&#39;alpha_h1&#39;, 0.07)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_h2&#39;] = kwargs.get(&#39;alpha_h2&#39;, 0.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;a_h3&#39;] = kwargs.get(&#39;alpha_h3&#39;, 20.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_h1&#39;] = kwargs.get(&#39;beta_h1&#39;, 1.0) # 分子</span>
        <span class="c1"># self.neuron_parameters[&#39;b_h2&#39;] = kwargs.get(&#39;beta_h2&#39;, 30.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;b_h3&#39;] = kwargs.get(&#39;beta_h3&#39;, 10.0)</span>
        <span class="c1">#</span>
        <span class="c1"># self.neuron_parameters[&#39;65&#39;] = kwargs.get(&#39;V65&#39;, 0.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;m&#39;] = kwargs.get(&#39;m&#39;, 0.5)</span>
        <span class="c1"># self.neuron_parameters[&#39;n&#39;] = kwargs.get(&#39;n&#39;, 0.5)</span>
        <span class="c1"># self.neuron_parameters[&#39;h&#39;] = kwargs.get(&#39;h&#39;, 0.06)</span>
        <span class="c1"># # self.neuron_parameters[&#39;b_h4&#39;] = kwargs.get(&#39;beta_h4&#39;, 1)</span>
        <span class="c1">#</span>
        <span class="c1"># self.neuron_parameters[&#39;V&#39;] = kwargs.get(&#39;V&#39;, 0.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;vth&#39;] = kwargs.get(&#39;v_th&#39;, 1.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># beta = self.neuron_parameters[&#39;tau_p&#39;] / self.neuron_parameters[&#39;tau_q&#39;]</span>
        <span class="c1"># V0 = (1 / (beta - 1)) * (beta ** (beta / (beta - 1)))</span>
        <span class="c1"># self._constant_variables[&#39;V0&#39;] = 1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Vreset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tauM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tauN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tauH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tauV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;65&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;V65&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;g_NA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;g_NA&#39;</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;g_K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;g_K&#39;</span><span class="p">,</span> <span class="mf">36.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;g_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;g_L&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;E_NA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;E_NA&#39;</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;E_K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;E_K&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;E_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;E_L&#39;</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_m1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_m1&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_m2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_m2&#39;</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_m3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_m3&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_m1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;beta_m1&#39;</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_m2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;beta_m2&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_m3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;beta_m3&#39;</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_n1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_n1&#39;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_n2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_n2&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_n3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_n3&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_n1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;beta_n1&#39;</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_n2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;beta_n2&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_n3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;beta_n3&#39;</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_h1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_h1&#39;</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_h2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_h2&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;a_h3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_h3&#39;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_h1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;beta_h1&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_h2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;beta_h2&#39;</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;b_h3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;beta_h3&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V65&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;65&#39;</span><span class="p">))</span>

        <span class="c1"># a_m = a_m1 * (-V + a_m2) / (exp((-V + a_m2) / a_m3) - 1)</span>
        <span class="c1"># b_m = b_m1 * exp((-V + b_m2) / b_m3)</span>
        <span class="c1"># alpha_m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vam&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;a_m2&#39;</span><span class="p">,</span> <span class="s1">&#39;V65&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vamd&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;Vam&#39;</span><span class="p">,</span> <span class="s1">&#39;a_m3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;expVamd1&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vamd&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;expVamd&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;expVamd1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;amtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;Vam&#39;</span><span class="p">,</span> <span class="s1">&#39;expVamd&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;a_m&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;a_m1&#39;</span><span class="p">,</span> <span class="s1">&#39;amtemp&#39;</span><span class="p">))</span>

        <span class="c1"># beta_m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vbm&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;b_m2&#39;</span><span class="p">,</span> <span class="s1">&#39;V65&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vbmd&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;Vbm&#39;</span><span class="p">,</span> <span class="s1">&#39;b_m3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;expVbmd&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vbmd&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;b_m&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;b_m1&#39;</span><span class="p">,</span> <span class="s1">&#39;expVbmd&#39;</span><span class="p">))</span>

        <span class="c1"># a_n = a_n1 * (-V + a_n2) / (exp((-V + a_n2) / a_n3) - 1)</span>
        <span class="c1"># b_n = b_n1 * exp((-V + b_n2) / b_n3)</span>
        <span class="c1"># alpha_n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Van&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;a_n2&#39;</span><span class="p">,</span> <span class="s1">&#39;V65&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vand&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;Van&#39;</span><span class="p">,</span> <span class="s1">&#39;a_n3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;expVand1&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vand&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;expVand&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;expVand1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;antemp&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;Van&#39;</span><span class="p">,</span> <span class="s1">&#39;expVand&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;a_n&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;a_n1&#39;</span><span class="p">,</span> <span class="s1">&#39;antemp&#39;</span><span class="p">))</span>

        <span class="c1"># beta_n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vbn&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;b_n2&#39;</span><span class="p">,</span> <span class="s1">&#39;V65&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vbnd&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;Vbn&#39;</span><span class="p">,</span> <span class="s1">&#39;b_n3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;expVbnd&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vbnd&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;b_n&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;b_n1&#39;</span><span class="p">,</span> <span class="s1">&#39;expVbnd&#39;</span><span class="p">))</span>

        <span class="c1"># a_h = a_h1 * exp((-V + a_h2) / a_h3)</span>
        <span class="c1"># b_h = b_h1 / (exp((-V + b_h2) / b_h3 + 1)</span>
        <span class="c1"># alpha_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vah&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;a_h2&#39;</span><span class="p">,</span> <span class="s1">&#39;V65&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vahd&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;Vah&#39;</span><span class="p">,</span> <span class="s1">&#39;a_h3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;expVahd&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vahd&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;a_h&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;a_h1&#39;</span><span class="p">,</span> <span class="s1">&#39;expVahd&#39;</span><span class="p">))</span>

        <span class="c1"># beta_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vbh&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;b_h2&#39;</span><span class="p">,</span> <span class="s1">&#39;V65&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vbhd&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;Vbh&#39;</span><span class="p">,</span> <span class="s1">&#39;b_h3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;expVbhd1&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vbhd&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;expVbhd&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;expVbhd1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;b_h&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;b_h1&#39;</span><span class="p">,</span> <span class="s1">&#39;expVbhd&#39;</span><span class="p">))</span>

        <span class="c1"># m = m + alpha_m * (1 - m) - beta_m * m</span>
        <span class="c1"># n = n + alpha_n * (1 - n) - beta_n * n</span>
        <span class="c1"># h = h + alpha_h * (1 - h) - beta_h * h</span>

        <span class="c1"># m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;mtemp1&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;mtemp2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;a_m&#39;</span><span class="p">,</span> <span class="s1">&#39;mtemp1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;betam&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;b_m&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;mtemp3&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;mtemp2&#39;</span><span class="p">,</span> <span class="s1">&#39;betam&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;mtemp4&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;tauM&#39;</span><span class="p">,</span> <span class="s1">&#39;mtemp3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;mtemp4&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">))</span>
        <span class="c1"># n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;ntemp1&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;ntemp2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;a_n&#39;</span><span class="p">,</span> <span class="s1">&#39;ntemp1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;betan&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;b_n&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;ntemp3&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;ntemp2&#39;</span><span class="p">,</span> <span class="s1">&#39;betan&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;ntemp4&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;tauN&#39;</span><span class="p">,</span> <span class="s1">&#39;ntemp3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;ntemp4&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">))</span>
        <span class="c1"># h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;htemp1&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;htemp2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;a_h&#39;</span><span class="p">,</span> <span class="s1">&#39;htemp1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;betah&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;b_h&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;htemp3&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;htemp2&#39;</span><span class="p">,</span> <span class="s1">&#39;betah&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;htemp4&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;tauH&#39;</span><span class="p">,</span> <span class="s1">&#39;htemp3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;htemp4&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">))</span>

        <span class="c1"># g_NAm3h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;m[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;m[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;m[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;m3h&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;h[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;g_NAm3h&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;g_NA&#39;</span><span class="p">,</span> <span class="s1">&#39;m3h&#39;</span><span class="p">))</span>

        <span class="c1"># g_Kn4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;n2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;n[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;n[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;n4&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;n2&#39;</span><span class="p">,</span> <span class="s1">&#39;n2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;g_Kn4&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;g_K&#39;</span><span class="p">,</span> <span class="s1">&#39;n4&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;d_NA&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;E_NA&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;d_K&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;E_K&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;d_L&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;E_L&#39;</span><span class="p">))</span>

        <span class="c1"># Ik, NA, K, L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;g_NAm3h&#39;</span><span class="p">,</span> <span class="s1">&#39;d_NA&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;g_Kn4&#39;</span><span class="p">,</span> <span class="s1">&#39;d_K&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;g_L&#39;</span><span class="p">,</span> <span class="s1">&#39;d_L&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Ik1&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Ik2&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;Ik1&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Ik&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;tauV&#39;</span><span class="p">,</span> <span class="s1">&#39;Ik2&#39;</span><span class="p">))</span>

        <span class="c1"># I</span>
        <span class="c1"># self._operations.append((&#39;I&#39;, &#39;var_mult&#39;, &#39;V0&#39;, &#39;I_synapse&#39;))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Ik&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">))</span>

        <span class="c1"># O</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;V[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span></div>


<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;hh&quot;</span><span class="p">,</span> <span class="n">HodgkinHuxleyModel</span><span class="p">)</span>



<div class="viewcode-block" id="LIFSTDPEXModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.LIFSTDPEXModel">[文档]</a><span class="k">class</span> <span class="nc">LIFSTDPEXModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    LIF model:</span>
<span class="sd">    V(t) = decay_v * (v - v_rest) + v_rest + I^n[t]</span>
<span class="sd">    I^n[t] = V0 * Isyn^n[t]  #V0 = 1</span>
<span class="sd">    theta(t) = decay_th * theta[t-1]</span>
<span class="sd">    if v &gt;= (vth + theta) then s_out = 1; else s_out = 0;</span>
<span class="sd">    Reset:</span>
<span class="sd">    V(t) = s_out * v_reset + (1 - s_out) * v; theta = theta + s_out * th_inc</span>

<span class="sd">    O^n[t] = spike_func(V^n[t-1])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LIFSTDPEXModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># initial value for state variables</span>
        <span class="c1"># self.neuron_parameters[&#39;decay_v&#39;] = kwargs.get(&#39;decay_v&#39;, np.exp(-1/100))</span>
        <span class="c1"># self.neuron_parameters[&#39;decay_th&#39;] = kwargs.get(&#39;decay_th&#39;, np.exp(-1/1e7))</span>
        <span class="c1"># self.neuron_parameters[&#39;th_inc&#39;] = kwargs.get(&#39;th_inc&#39;, 0.05)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_th&#39;] = kwargs.get(&#39;v_th&#39;, -52.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_rest&#39;] = kwargs.get(&#39;v_rest&#39;, -65.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_reset&#39;] = kwargs.get(&#39;v_reset&#39;, -60.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">65.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;theta[stay]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Vth_theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># self._constant_variables[&#39;V0&#39;] = 1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">52.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Vreset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_reset&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">60.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Vrest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_rest&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">65.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;th_inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;th_inc&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;decay_th&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decay_th&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mf">1e7</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;decay_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decay_v&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>


        <span class="c1"># self._operations.append((&#39;I&#39;, &#39;var_mult&#39;, &#39;V0&#39;, &#39;I_synapse[updated]&#39;))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;PSP1&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Vrest&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;PSP2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;decay_v&#39;</span><span class="p">,</span> <span class="s1">&#39;PSP1&#39;</span><span class="p">,</span> <span class="s1">&#39;Vrest&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;PSP2&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;theta_temp&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;decay_th&#39;</span><span class="p">,</span> <span class="s1">&#39;theta[stay]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vth_theta&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">,</span> <span class="s1">&#39;theta_temp&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth_theta&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting1&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting3&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting1&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting3&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting_theta&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">,</span> <span class="s1">&#39;th_inc&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;theta[stay]&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;theta_temp&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting_theta&#39;</span><span class="p">))</span></div>


<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;lifstdp_ex&quot;</span><span class="p">,</span> <span class="n">LIFSTDPEXModel</span><span class="p">)</span>

<div class="viewcode-block" id="LIFSTDPIHModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.LIFSTDPIHModel">[文档]</a><span class="k">class</span> <span class="nc">LIFSTDPIHModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    LIF model:</span>
<span class="sd">    V(t) = decay_v * (v - v_rest) + v_rest + I^n[t]</span>
<span class="sd">    I^n[t] = V0 * Isyn^n[t]  #V0 = 1</span>

<span class="sd">    Reset:</span>
<span class="sd">    V(t) = s_out * v_reset + (1 - s_out) * v;</span>

<span class="sd">    O^n[t] = spike_func(V^n[t-1])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LIFSTDPIHModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># initial value for state variables</span>
        <span class="c1"># self.neuron_parameters[&#39;decay_v&#39;] = kwargs.get(&#39;decay_v&#39;, np.exp(-1/10))</span>
        <span class="c1"># self.neuron_parameters[&#39;v_th&#39;] = kwargs.get(&#39;v_th&#39;, -40.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_rest&#39;] = kwargs.get(&#39;v_rest&#39;, -60.0)</span>
        <span class="c1"># self.neuron_parameters[&#39;v_reset&#39;] = kwargs.get(&#39;v_reset&#39;, -45.0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">60.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># self._constant_variables[&#39;V0&#39;] = 1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_variables</span><span class="p">[</span><span class="s1">&#39;Vth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_th&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Vreset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_reset&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;Vrest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_rest&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">60.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;decay_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decay_v&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>


        <span class="c1"># self._operations.append((&#39;I&#39;, &#39;var_mult&#39;, &#39;V0&#39;, &#39;I_synapse[updated]&#39;))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;PSP1&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Vrest&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;PSP2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;decay_v&#39;</span><span class="p">,</span> <span class="s1">&#39;PSP1&#39;</span><span class="p">,</span> <span class="s1">&#39;Vrest&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;PSP2&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Vth&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting1&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vreset&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;O[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Resetting3&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vtemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting1&#39;</span><span class="p">,</span> <span class="s1">&#39;Resetting3&#39;</span><span class="p">))</span></div>


<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;lifstdp_ih&quot;</span><span class="p">,</span> <span class="n">LIFSTDPIHModel</span><span class="p">)</span>




<div class="viewcode-block" id="CANN_MeanFieldModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.CANN_MeanFieldModel">[文档]</a><span class="k">class</span> <span class="nc">CANN_MeanFieldModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mean Field Model used in &quot;Fung CC, Wong KY, Wu S. A moving bump in a continuous manifold: a comprehensive study of</span>
<span class="sd">    the tracking dynamics of continuous attractor neural networks. Neural Comput. 2010 Mar;22(3):752-92. doi: 10.1162/neco.2009.07-08-824. &quot;</span>
<span class="sd">    &quot;Wu S, Wong KY, Fung CC, Mi Y, Zhang W. Continuous Attractor Neural Networks: Candidate of a Canonical Model for</span>
<span class="sd">    Neural Information Representation.F1000Res. 2016 Feb 10;5:F1000 Faculty Rev-156. doi: 10.12688/f1000research.7387.1. &quot;</span>

<span class="sd">    U = U + dt/tau * (Iext + rho*WgtSum - U)</span>
<span class="sd">    O = U^2/(1 + k*rho*sum(U^2))</span>
<span class="sd">    (WgtSum = weight*O_pre)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CANN_MeanFieldModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;k_rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Iext&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Isyn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Isum&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;Isyn&#39;</span><span class="p">,</span> <span class="s1">&#39;Iext&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;dU&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Isum&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;dU&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;ReU&#39;</span><span class="p">,</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;U[updated]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;U2&#39;</span><span class="p">,</span> <span class="s1">&#39;var_mult&#39;</span><span class="p">,</span> <span class="s1">&#39;ReU&#39;</span><span class="p">,</span> <span class="s1">&#39;ReU&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;SumU2&#39;</span><span class="p">,</span> <span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;U2&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;RBase&#39;</span><span class="p">,</span><span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;k_rho&#39;</span><span class="p">,</span> <span class="s1">&#39;SumU2&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;U2&#39;</span><span class="p">,</span> <span class="s1">&#39;RBase&#39;</span><span class="p">))</span></div>


<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;cann_field&quot;</span><span class="p">,</span> <span class="n">CANN_MeanFieldModel</span><span class="p">)</span>





<div class="viewcode-block" id="MeanFieldModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.MeanFieldModel">[文档]</a><span class="k">class</span> <span class="nc">MeanFieldModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mean Field Model of LIF neuron &quot;</span>

<span class="sd">    U = U + dt/tau * (rho*(Iext + WgtSum) - U)</span>
<span class="sd">    O = relu(U)</span>
<span class="sd">    (WgtSum = weight*O_pre)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MeanFieldModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant_variables</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Iext&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;WgtSum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Isum&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;WgtSum&#39;</span><span class="p">,</span> <span class="s1">&#39;Iext&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;dU&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;Isum&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;dU&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;U[updated]&#39;</span><span class="p">))</span></div>



<span class="n">NeuronModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;meanfield&quot;</span><span class="p">,</span> <span class="n">MeanFieldModel</span><span class="p">)</span>


<div class="viewcode-block" id="SimpleRateModel"><a class="viewcode-back" href="../../../spaic.Neuron.html#spaic.Neuron.Neuron.SimpleRateModel">[文档]</a><span class="k">class</span> <span class="nc">SimpleRateModel</span><span class="p">(</span><span class="n">NeuronModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rate model  &quot;</span>

<span class="sd">    U = U + dt/tau * (sigmoid(Iext + WgtSum) - U)</span>
<span class="sd">    (WgtSum = weight*O_pre)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MeanFieldModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_membrane_variables</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;Iext&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;WgtSum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Isum&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;WgtSum&#39;</span><span class="p">,</span> <span class="s1">&#39;Iext&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="s1">&#39;Isum&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;dU&#39;</span><span class="p">,</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;var_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;dU&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">))</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2021, Zhejiang Lab.

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>