

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>spaic.Backend.Backend &mdash; SPAIC 0.5 文档</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> SPAIC
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_structure/0_index.html">基础结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input_output.html">输入输出</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../backend.html">模拟后端 Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../save_model.html">保存与读取模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../custom/0_index.html">自定义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../monitor.html">监视器</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SPAIC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">模块代码</a> &raquo;</li>
        
      <li>spaic.Backend.Backend</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>spaic.Backend.Backend 源代码</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on 2020/8/6</span>
<span class="sd">@project: SPAIC</span>
<span class="sd">@filename: Backend</span>
<span class="sd">@author: Hong Chaofei</span>
<span class="sd">@contact: hongchf@gmail.com</span>
<span class="sd">@description:</span>
<span class="sd">定义网络仿真使用的backend，如 Pytorch, Tensorflow, CUDA, 达尔文芯片等，以及相应的微分方程求解方法比如 Euler, 2阶 Runge-Kutta等</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span><span class="p">,</span> <span class="n">ABC</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">..Network.BaseModule</span> <span class="kn">import</span> <span class="n">BaseModule</span><span class="p">,</span> <span class="n">VariableAgent</span>
<span class="kn">from</span> <span class="nn">..Network.DelayQueue</span> <span class="kn">import</span> <span class="n">DelayQueue</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="n">backends</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>


<div class="viewcode-block" id="Backend"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend">[文档]</a><span class="k">class</span> <span class="nc">Backend</span><span class="p">(</span><span class="n">BaseModule</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Basic backend class. All specified backend backend should subclass it.</span>
<span class="sd">    The backend is a parameter for the build function and becomes an attribute of all objects defined</span>
<span class="sd">    in the frontend backend network in building process. These objects build their initial data</span>
<span class="sd">    and specified operations into the attributes of backend, according to _variables</span>
<span class="sd">    and _operations respectively. The data will update in each step according the computation graph.</span>
<span class="sd">    Args:</span>
<span class="sd">        dt (float, optional): the length of a backend timestep, in millisecond.</span>
<span class="sd">    Attributes:</span>
<span class="sd">        device (str): the desired device of returned tensor. Its value can be &#39;cpu&#39; or &#39;cuda&#39;. If None, uses</span>
<span class="sd">            the current device for the default tensor type.</span>
<span class="sd">        builded (bool): whether the object defined in the frontend backend network has been builded.</span>
<span class="sd">        time (float): current backend time, in millisecond.</span>
<span class="sd">        n_time_step (int): the num of current time step.</span>

<span class="sd">        _variables (OrderedDict): records all variables from the build function of frontend objects.</span>
<span class="sd">        _parameters_dict (OrderedDict): records the variables to be trained.</span>
<span class="sd">        _InitVariables_dict (OrderedDict): reserves a copy of the initialization variables for initialization.</span>
<span class="sd">        _graph_var_dicts (dict): has following format: {&#39;variables_dict&#39;: self._variables, &#39;temp_dict&#39;: dict(), &#39;update_dict&#39;: dict(), &#39;reduce_dict&#39;: dict()},</span>
<span class="sd">            recording the intermediate value of variables in computation progress.</span>

<span class="sd">        basic_operate (dict): dictionary of basic operators, mapping from operator names using in frontend to</span>
<span class="sd">            the funtion objects implemented in backend.</span>
<span class="sd">        _operations (list): records all basic operations from the build function of frontend objects, each of</span>
<span class="sd">            which has following format: [ret_var_name: str, operation_name, input_var_name1: str, input_var_name2 :str, ...].</span>
<span class="sd">        _graph_operations (list): redefine each basic operation, that is, add the corresponding keyword in the _graph_var_dicts to each variable,</span>
<span class="sd">            which has following format: [(dict_type, ret_var_name), operation_name, [(dict_type1, input_var_name1),(dict_type2, input_var_name2),...]].</span>
<span class="sd">        _standalone_operations (list): records all standalone operations from the build function of frontend objects,</span>
<span class="sd">            each of which has following format: (ret_var_name: str, function, input_var_names: list).</span>
<span class="sd">        _initial_operations (list): records all initial operations from the build function of frontend objects, each of</span>
<span class="sd">            which has following format: (ret_var_name: str, function, input_var_names: list).</span>

<span class="sd">        _monitors (list): records all monitors defined in fronted network through build function of Monitor object.</span>

<span class="sd">    Methods:</span>
<span class="sd">        build_graph: build a computation graph before performing the calculation.</span>
<span class="sd">        graph_update_step: update value of _graph_var_dicts.</span>
<span class="sd">        initial_step: initialize network variables.</span>
<span class="sd">        update_step: update the return variables of standalone operations and basic operations and current backend time.</span>
<span class="sd">        r_update_step: update the return variables of basic operations without using graph_update_step().</span>
<span class="sd">        add_variable: add variables from front objects to _variables of Backend.</span>
<span class="sd">        add_backend_variable: add variables according to the specified backend.</span>
<span class="sd">        add_operation: add basic operations from front objects to _operations of Backend.</span>
<span class="sd">        register_standalone: add standalone operations from front objects to _standalone_operations of Backend.</span>
<span class="sd">        register_initial: add initial operations from front objects to _initial_operations of Backend.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">basic_operate</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">param_init_operate</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># -&gt; param_init_operate</span>

    <span class="n">backend_name</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Backend</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">builded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span>  <span class="c1"># the length of a backend timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># current backend time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_time_step</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># the num of current time step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># build from orderedDict to Tuple</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clamp_parameter_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delay_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># store conduction delays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SparseVariables_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_InitVariables_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_standalone_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_monitors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>  <span class="c1"># TODO: need to add to update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stored_states</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># TODO: store network self._variables in the dict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;var_linear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_linear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;mat_linear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_linear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;mat_mult_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_mult_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;mat_mult_weight_complex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_mult_weight_complex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;mat_mult_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_mult_pre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;mat_mult&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_mult</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;bmm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;ger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;sparse_mat_mult_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse_mat_mult_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;var_mult&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_mult</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;div&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">div</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;stack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;permute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">permute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;assign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;unsqueeze&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsqueeze</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;reset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_sum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;conv_2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_2d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;tan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;log2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;log10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;conv_max_pool2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_max_pool2d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;conv_avg_pool2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_avg_pool2d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;conv_add_bias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_add_bias</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;max_pool2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pool2d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;avg_pool2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_pool2d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;dropout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;reshape_mat_mult&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape_mat_mult</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;mult_sum_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mult_sum_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;im2col_indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">im2col_indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;conv2d_flatten&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2d_flatten</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="s1">&#39;feature_map_flatten&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_map_flatten</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param_init_operate</span><span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_init_operate</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_init_operate</span><span class="p">[</span><span class="s1">&#39;xavier_uniform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xavier_uniform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_init_operate</span><span class="p">[</span><span class="s1">&#39;xavier_noraml&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xavier_normal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_init_operate</span><span class="p">[</span><span class="s1">&#39;kaiming_uniform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kaiming_uniform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_init_operate</span><span class="p">[</span><span class="s1">&#39;kaiming_normal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kaiming_normal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_init_operate</span><span class="p">[</span><span class="s1">&#39;zero_init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_init</span>

        <span class="c1"># self._graph_var_dicts = {&#39;variables_dict&#39;: self._variables, &#39;temp_dict&#39;: dict(), &#39;update_dict&#39;: dict(),</span>
        <span class="c1">#                          &#39;reduce_dict&#39;: dict()}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_push_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<div class="viewcode-block" id="Backend.set_batch_size"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.set_batch_size">[文档]</a>    <span class="k">def</span> <span class="nf">set_batch_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span> <span class="o">=</span> <span class="n">batch_size</span></div>

<div class="viewcode-block" id="Backend.get_batch_size"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.get_batch_size">[文档]</a>    <span class="k">def</span> <span class="nf">get_batch_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span></div>

<div class="viewcode-block" id="Backend.set_runtime"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.set_runtime">[文档]</a>    <span class="k">def</span> <span class="nf">set_runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runtime</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">=</span> <span class="n">runtime</span></div>

<div class="viewcode-block" id="Backend.build_graph"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.build_graph">[文档]</a>    <span class="k">def</span> <span class="nf">build_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Build a computation graph before performing the calculation.</span>
<span class="sd">        Note that only the basic operations are redefiend into the _graph_operations list. The format of _graph_operations is as follows:</span>
<span class="sd">        [(dict_type, ret_var_name), operation_name, [(dict_type1, input_var_name1),(dict_type2, input_var_name2),...]].</span>
<span class="sd">        Traverse all basic operations and add the corresponding keyword in the _graph_var_dicts as dict_type to each variable in basic operation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">variables_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initial_step</span><span class="p">()</span>

        <span class="n">operation_type</span> <span class="o">=</span> <span class="s1">&#39;update_dict or temp_dict or reduce_dict&#39;</span>
        <span class="c1"># traverse basic operations</span>

        <span class="n">fetch_operations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">push_operations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">graph_operations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># self._graph_operations = list()</span>
        <span class="c1"># self._push_operations = list()</span>
        <span class="c1"># self._fetch_operations = list()</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># functions with no input and output will not push into the computation graph</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; Operation lacks both input and output can&#39;t be build&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fetch_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">push_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graph_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

        <span class="c1">################################</span>
        <span class="c1">##  for push_operation build  ##</span>
        <span class="c1">################################</span>
        <span class="n">update_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">reduce_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">push_operations</span><span class="p">):</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_outputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># if the operation return one variable, then it is appended into a list, to accordant with multi-variable returns</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span>
            <span class="c1"># return variable is a list</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
                    <span class="c1"># when the same ret_var_name occurs more than once, op[0] is added to the reduce_dict of _graph_var_dicts</span>
                    <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">update_dict</span><span class="p">:</span>
                        <span class="n">reduce_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">update_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">],</span> <span class="n">outputs</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
                        <span class="n">label_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                        <span class="c1"># # add op[0] into graph: reduce_dict</span>
                        <span class="c1"># self._graph_var_dicts[&#39;reduce_dict&#39;][op[0]] = []</span>
                        <span class="c1"># revise the first reduce operation</span>
                        <span class="k">for</span> <span class="n">gop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_push_operations</span><span class="p">:</span>
                            <span class="n">tmp_label_outputs</span> <span class="o">=</span> <span class="n">gop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">tmp_ind</span><span class="p">,</span> <span class="n">tmp_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tmp_label_outputs</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">tmp_label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">var_name</span><span class="p">:</span>
                                    <span class="n">tmp_label_outputs</span><span class="p">[</span><span class="n">tmp_ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
                                    <span class="k">break</span>
                        <span class="k">del</span> <span class="n">update_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">reduce_dict</span><span class="p">:</span>
                        <span class="n">reduce_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                        <span class="n">label_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># In the push_operation, new data is directly pushed to update_dict, as</span>
                        <span class="c1"># there is no need to remain the last step variable value</span>
                        <span class="n">update_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                        <span class="n">label_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;update_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No state variable to get the input &quot;</span><span class="p">)</span>

            <span class="c1"># add the operation to built graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_push_operations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">label_outputs</span><span class="p">,</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[]])</span>

        <span class="c1"># for var_name in reduce_dict:</span>
        <span class="c1">#     # add the reduce_sum operation into the graph</span>
        <span class="c1">#     self._graph_operations.append(</span>
        <span class="c1">#         [[(&#39;update_dict&#39;, var_name)], self.reduce_sum_update, [(&#39;reduce_dict&#39;, var_name)]])</span>

        <span class="c1">#################################</span>
        <span class="c1">##  for graph_operation build  ##</span>
        <span class="c1">#################################</span>
        <span class="n">temp_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># update_dict = dict()</span>
        <span class="c1"># reduce_dict = dict()</span>
        <span class="n">temp_reduce_sum_ops</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">graph_operations</span><span class="p">):</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="c1"># try:</span>
                <span class="c1">#     var_name in self._variables</span>
                <span class="c1"># except:</span>
                <span class="c1">#     a = 1</span>

                <span class="k">if</span> <span class="s1">&#39;[updated]&#39;</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
                    <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[updated]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">update_dict</span><span class="p">:</span>
                        <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">update_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
                        <span class="n">label_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;update_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">reduce_dict</span><span class="p">:</span>
                        <span class="c1"># if the reduce_dict[var_name] is frozen: do reduce_sum operation before this op, and put the value to update_dict</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">reduce_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]))</span>
                        <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="n">label_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;update_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                        <span class="n">temp_reduce_sum_ops</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">reduce_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">])))</span>
                        <span class="c1"># add the reduce_sum operation into the graph</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[[(</span><span class="s1">&#39;update_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_sum_update</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)]])</span>
                    <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
                        <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
                        <span class="n">label_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;variables_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; No State Variable [</span><span class="si">%s</span><span class="s2">] in the update_dict&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
                    <span class="n">label_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;variables_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>

                <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
                    <span class="n">label_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; No State Variable [</span><span class="si">%s</span><span class="s2">] in the variable dict&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">)</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_outputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">var_check</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">inputs</span><span class="p">)</span>
                <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">var_check</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">inputs</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outputs</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
                        <span class="c1"># when the same ret_var_name occurs more than once, op[0] is added to the reduce_dict of _graph_var_dicts</span>
                        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">update_dict</span><span class="p">:</span>
                            <span class="n">reduce_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">update_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">],</span> <span class="n">outputs</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
                            <span class="n">label_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                            <span class="c1"># # add op[0] into graph: reduce_dict</span>
                            <span class="c1"># self._graph_var_dicts[&#39;reduce_dict&#39;][op[0]] = []</span>
                            <span class="c1"># revise the first reduce operation</span>
                            <span class="n">InGop</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_push_operations</span><span class="p">:</span>
                                <span class="n">tmp_label_outputs</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">tmp_ind</span><span class="p">,</span> <span class="n">tmp_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tmp_label_outputs</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="n">tmp_label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">var_name</span><span class="p">:</span>
                                        <span class="n">tmp_label_outputs</span><span class="p">[</span><span class="n">tmp_ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
                                        <span class="n">InGop</span> <span class="o">=</span> <span class="kc">False</span>
                                        <span class="k">break</span>
                            <span class="k">if</span> <span class="n">InGop</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">gop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="p">:</span>
                                    <span class="n">tmp_label_outputs</span> <span class="o">=</span> <span class="n">gop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="k">for</span> <span class="n">tmp_ind</span><span class="p">,</span> <span class="n">tmp_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tmp_label_outputs</span><span class="p">):</span>
                                        <span class="k">if</span> <span class="n">tmp_label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">var_name</span><span class="p">:</span>
                                            <span class="n">tmp_label_outputs</span><span class="p">[</span><span class="n">tmp_ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
                                            <span class="k">break</span>
                            <span class="k">del</span> <span class="n">update_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">reduce_dict</span><span class="p">:</span>
                            <span class="n">reduce_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                            <span class="n">label_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">update_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                            <span class="n">label_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;update_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                        <span class="n">label_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;temp_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>

            <span class="c1"># add the operation to built graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">label_outputs</span><span class="p">,</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label_inputs</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">reduce_op</span> <span class="ow">in</span> <span class="n">temp_reduce_sum_ops</span><span class="p">:</span>
            <span class="n">reduce_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reduce_dict</span><span class="p">[</span><span class="n">reduce_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">reduce_len</span> <span class="o">!=</span> <span class="n">reduce_op</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Can&#39;t use [updated] tag for variable: </span><span class="si">%s</span><span class="s2">, as it is a reduce_dict variable which is have updating conflict&quot;</span> <span class="o">%</span>
                    <span class="n">reduce_op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">reduce_dict</span><span class="p">[</span><span class="n">reduce_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># for reduced variables that not used within [update]</span>
        <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">reduce_dict</span><span class="p">:</span>
            <span class="c1"># add the reduce_sum operation into the graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[[(</span><span class="s1">&#39;update_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_sum_update</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)]])</span>

        <span class="c1">#################################</span>
        <span class="c1">##  for fetch_operation build  ##</span>
        <span class="c1">#################################</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fetch_operations</span><span class="p">):</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s1">&#39;[updated]&#39;</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
                    <span class="c1"># there is no need to have updated tag, as all variables computed in graph_operation have benn updated</span>
                    <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[updated]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
                    <span class="n">label_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;variables_dict&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="p">))</span>
                <span class="c1"># elif var_name in temp_dict:</span>
                <span class="c1">#     inputs.append(temp_dict[var_name])</span>
                <span class="c1">#     label_inputs.append((&#39;temp_dict&#39;, var_name))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; No State Variable [</span><span class="si">%s</span><span class="s2">] in the update_dict&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">var_check</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">inputs</span><span class="p">)</span>
            <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>

            <span class="c1"># add the operation to built graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_operations</span><span class="o">.</span><span class="n">append</span><span class="p">([[],</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label_inputs</span><span class="p">])</span>

        <span class="c1"># self._variables.update(update_dict)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="p">)</span></div>

<div class="viewcode-block" id="Backend.var_check"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.var_check">[文档]</a>    <span class="k">def</span> <span class="nf">var_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For specified operation, check the type or the shape of input variables.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;mat_mult&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2"> do not match&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Backend.graph_update_step_r"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.graph_update_step_r">[文档]</a>    <span class="k">def</span> <span class="nf">graph_update_step_r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

            <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;reduce_dict&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">][</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>

            <span class="c1"># if &#39;[updated]&#39; in op[0][1]:</span>
            <span class="c1">#     op_name = op[0][1].strip(&#39;[updated]&#39;)</span>
            <span class="c1">#     if op_name in self._graph_var_dicts[&#39;update_dict&#39;] and op_name in self._graph_var_dicts[&#39;variables_dict&#39;]:</span>
            <span class="c1">#         self._graph_var_dicts[&#39;update_dict&#39;][op_name] = self._graph_var_dicts[&#39;temp_dict&#39;][op[0][1]]  # 更新返回名中带[updated]的变量的值</span>

        <span class="k">return</span>  <span class="c1"># tuple(self._graph_var_dicts[&#39;variables_dict&#39;].values())</span></div>

<div class="viewcode-block" id="Backend.graph_update_step"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.graph_update_step">[文档]</a>    <span class="k">def</span> <span class="nf">graph_update_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">update_dict</span><span class="p">,</span> <span class="n">reduce_dict</span><span class="p">):</span>
        <span class="n">temp_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># update_dict = dict()</span>
        <span class="c1"># reduce_dict = dict()</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span><span class="p">:</span>
            <span class="c1"># for inputs</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;variables_dict&#39;</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="k">elif</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;temp_dict&#39;</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="k">elif</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;update_dict&#39;</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">update_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="k">elif</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;reduce_dict&#39;</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reduce_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="c1"># compute the operation</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>
            <span class="c1"># assign the result variables</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;temp_dict&#39;</span><span class="p">:</span>
                    <span class="n">temp_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;update_dict&#39;</span><span class="p">:</span>
                    <span class="n">update_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;reduce_dict&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">reduce_dict</span><span class="p">:</span>
                        <span class="n">reduce_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">reduce_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">update_dict</span></div>

<div class="viewcode-block" id="Backend.push_update_step"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.push_update_step">[文档]</a>    <span class="k">def</span> <span class="nf">push_update_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reduce_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">update_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_push_operations</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;update_dict&#39;</span><span class="p">:</span>
                    <span class="n">update_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">reduce_dict</span><span class="p">:</span>
                    <span class="n">reduce_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reduce_dict</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">update_dict</span><span class="p">,</span> <span class="n">reduce_dict</span></div>

<div class="viewcode-block" id="Backend.fetch_update_step"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.fetch_update_step">[文档]</a>    <span class="k">def</span> <span class="nf">fetch_update_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_operations</span><span class="p">:</span>
            <span class="c1"># for inputs</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Backend.initial_step"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.initial_step">[文档]</a>    <span class="k">def</span> <span class="nf">initial_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize network variables.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Initialize the current backend time and the num of time step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># current backend time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_time_step</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;[stay]&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_InitVariables_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Initialize untrainable variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Initialize system spacial variables such as backend dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="s1">&#39;[dt]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_InitVariables_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Initialize the trainable parameters</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">clamp_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clamp_parameter_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">clamp_code</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">clamp_code</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SparseVariables_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">index_name</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_sparse_index&#39;</span>
            <span class="n">value_name</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_sparse_value&#39;</span>
            <span class="n">shape_name</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_sparse_shape&#39;</span>
            <span class="k">if</span> <span class="n">index_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">value_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse_to_dense</span><span class="p">(</span><span class="n">index_name</span><span class="p">,</span> <span class="n">value_name</span><span class="p">,</span> <span class="n">shape_name</span><span class="p">)</span>

        <span class="c1"># Initialize the record of Monitor</span>
        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monitors</span><span class="p">:</span>
            <span class="n">monitor</span><span class="o">.</span><span class="n">init_record</span><span class="p">()</span>

        <span class="c1"># Traverse initial operations</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_operations</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; No State Variable [</span><span class="si">%s</span><span class="s2">] in the variable dict&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>

        <span class="c1"># Change intial variable&#39;s batch_size</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span><span class="p">):</span>
                    <span class="n">expand_shape</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">expand_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">expand_shape</span><span class="p">))</span></div>

            <span class="c1"># if &#39;{O}&#39; in key:</span>
            <span class="c1">#     o_shape = self._variables[key].shape</span>
            <span class="c1">#</span>
            <span class="c1">#     shape = []</span>
            <span class="c1">#     for s in o_shape:</span>
            <span class="c1">#         if s != 1:</span>
            <span class="c1">#             shape.append(s)</span>
            <span class="c1">#         else:</span>
            <span class="c1">#             shape.append(self._batch_size)</span>
            <span class="c1">#     self._variables[key] = torch.zeros(shape, dtype=torch.float32, device=self.device)</span>

<div class="viewcode-block" id="Backend.clear_step"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.clear_step">[文档]</a>    <span class="k">def</span> <span class="nf">clear_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Returns:</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_push_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_operations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.initial_continue_step"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.initial_continue_step">[文档]</a>    <span class="k">def</span> <span class="nf">initial_continue_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize network for continuous run.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span></div>

<div class="viewcode-block" id="Backend.update_step"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.update_step">[文档]</a>    <span class="k">def</span> <span class="nf">update_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update the return variables of standalone operations and basic operations and current backend time.</span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple(self._variables.values())</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># push input data</span>
        <span class="n">update_dict</span><span class="p">,</span> <span class="n">reduce_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_update_step</span><span class="p">()</span>

        <span class="c1"># static graph compuation</span>
        <span class="n">update_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_update_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">,</span> <span class="n">update_dict</span><span class="p">,</span> <span class="n">reduce_dict</span><span class="p">)</span>

        <span class="c1"># Update time and state variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_time_step</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_time_step</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">update_dict</span><span class="p">)</span>

        <span class="c1"># fetch output data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fetch_update_step</span><span class="p">()</span>

        <span class="c1"># Record Variables</span>
        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monitors</span><span class="p">:</span>
            <span class="n">monitor</span><span class="o">.</span><span class="n">update_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

<div class="viewcode-block" id="Backend.update_time_steps"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.update_time_steps">[文档]</a>    <span class="k">def</span> <span class="nf">update_time_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_step</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.r_update_step"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.r_update_step">[文档]</a>    <span class="k">def</span> <span class="nf">r_update_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update the return variables of basic operations without using graph_update_step().</span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple(self._variables.values())</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">reduce_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;temp_dict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Traverse standalone operations</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standalone_operations</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s1">&#39;pytorch&#39;</span> <span class="ow">in</span> <span class="n">backends</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;pytorch&#39;</span> <span class="ow">in</span> <span class="n">backends</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">))</span>

        <span class="c1"># update one time_step</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;variables_dict&#39;</span><span class="p">]:</span>
                <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="s1">&#39;[updated]&#39;</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
                        <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[updated]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">]:</span>
                            <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">][</span><span class="n">var_name</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; No State Variable [</span><span class="si">%s</span><span class="s2">] in the update_dict&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;variables_dict&#39;</span><span class="p">]:</span>
                        <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;variables_dict&#39;</span><span class="p">][</span><span class="n">var_name</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;temp_dict&#39;</span><span class="p">]:</span>
                        <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;temp_dict&#39;</span><span class="p">][</span><span class="n">var_name</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; No State Variable [</span><span class="si">%s</span><span class="s2">] in the variable dict&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">][</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;reduce_dict&#39;</span><span class="p">][</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">][</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                                                       <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">][</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
                    <span class="k">pass</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="s1">&#39;[updated]&#39;</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
                        <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[updated]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">]:</span>
                            <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">][</span><span class="n">var_name</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; No State Variable [</span><span class="si">%s</span><span class="s2">] in the update_dict&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;variables_dict&#39;</span><span class="p">]:</span>
                        <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;variables_dict&#39;</span><span class="p">][</span><span class="n">var_name</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;temp_dict&#39;</span><span class="p">]:</span>
                        <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;temp_dict&#39;</span><span class="p">][</span><span class="n">var_name</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; No State Variable [</span><span class="si">%s</span><span class="s2">] in the variable dict&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;temp_dict&#39;</span><span class="p">][</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;[updated]&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[updated]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">op_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">][</span><span class="n">op_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;temp_dict&#39;</span><span class="p">][</span>
                            <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># update the variable in update_dict</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; No State Variable [</span><span class="si">%s</span><span class="s2">] in the update_dict&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">)</span>

        <span class="c1"># Update reduce_dict into update_dict</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">reduce_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># update time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_time_step</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_time_step</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;variables_dict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">[</span><span class="s1">&#39;update_dict&#39;</span><span class="p">])</span>

        <span class="c1"># Record Variables</span>
        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monitors</span><span class="p">:</span>
            <span class="n">monitor</span><span class="o">.</span><span class="n">update_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_var_dicts</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

<div class="viewcode-block" id="Backend.reduce_sum_update"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.reduce_sum_update">[文档]</a>    <span class="k">def</span> <span class="nf">reduce_sum_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">reduced</span></div>

<div class="viewcode-block" id="Backend.get_varialble"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.get_varialble">[文档]</a>    <span class="k">def</span> <span class="nf">get_varialble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;not found variable:</span><span class="si">%s</span><span class="s2"> in the backend&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Backend.set_variable_value"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.set_variable_value">[文档]</a>    <span class="k">def</span> <span class="nf">set_variable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_parameter</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set the backend value, in specific Backend</span>
<span class="sd">        Args:</span>
<span class="sd">            name:</span>
<span class="sd">            value:</span>
<span class="sd">            is_parameter:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>


<div class="viewcode-block" id="Backend.add_variable"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.add_variable">[文档]</a>    <span class="k">def</span> <span class="nf">add_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_parameter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_constant</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add variables from front objects to _variables of Backend and get copies to assign to _parameters_dict and _InitVariables_dict.</span>
<span class="sd">        Args:</span>
<span class="sd">            name (str): the name of the added variable</span>
<span class="sd">            shape (list, int): the shape of the variable</span>
<span class="sd">            value (optional): the value of the variable</span>
<span class="sd">            is_parameter (bool, optional): whether the variable is trainable</span>
<span class="sd">            init (optinal):</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">is_parameter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_backend_variable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_sparse</span><span class="o">=</span><span class="n">is_sparse</span><span class="p">,</span>
                                                                    <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">init_param</span><span class="o">=</span><span class="n">init_param</span><span class="p">)</span>
            <span class="c1"># store clamp operations</span>
            <span class="k">if</span> <span class="nb">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clamp_parameter_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clamp_</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clamp_parameter_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clamp_min_</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="nb">min</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clamp_parameter_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clamp_max_</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="nb">max</span><span class="p">])</span>


        <span class="c1"># 稀疏矩阵weight非叶子节点，反传的时候更新的是weight中的value,但前向计算的时候用的是weight,所以对于稀疏矩阵要单独用个dict记录以便初始化</span>
        <span class="k">elif</span> <span class="n">is_sparse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SparseVariables_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_backend_variable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                         <span class="n">is_sparse</span><span class="o">=</span><span class="n">is_sparse</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span><span class="n">init_param</span><span class="o">=</span><span class="n">init_param</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_constant</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_InitVariables_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_InitVariables_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_backend_variable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                       <span class="n">is_sparse</span><span class="o">=</span><span class="n">is_sparse</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
                                                                       <span class="n">init_param</span><span class="o">=</span><span class="n">init_param</span><span class="p">)</span>

        <span class="n">var_agent</span> <span class="o">=</span> <span class="n">VariableAgent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">is_parameter</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">var_agent</span></div>

<div class="viewcode-block" id="Backend.has_variable"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.has_variable">[文档]</a>    <span class="k">def</span> <span class="nf">has_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_InitVariables_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SparseVariables_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Backend.add_delay"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.add_delay">[文档]</a>    <span class="k">def</span> <span class="nf">add_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">max_delay</span><span class="p">):</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_delay</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">max_len</span> <span class="o">&lt;</span> <span class="n">max_len</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delay_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="n">max_len</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delay_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DelayQueue</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_initial</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">initial</span><span class="p">,</span> <span class="p">[</span><span class="n">var_name</span><span class="p">,</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_standalone</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">push</span><span class="p">,</span> <span class="p">[</span><span class="n">var_name</span><span class="p">,</span> <span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay_dict</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span></div>


<div class="viewcode-block" id="Backend.add_backend_variable"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.add_backend_variable">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">add_backend_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init_param</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method will be overwritten by different subclasses to add variables to _variables of specified backend.</span>
<span class="sd">        Args:</span>
<span class="sd">            name (str): the name of the added variable</span>
<span class="sd">            shape (list, int): the shape of the variable</span>
<span class="sd">            value (optional): the value of the variable</span>
<span class="sd">            is_parameter (bool, optional): whether the variable is trainable</span>
<span class="sd">            init (optinal):</span>
<span class="sd">            grad (bool, optional): whether to use grad</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.sparse_to_dense"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.sparse_to_dense">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">sparse_to_dense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_name</span><span class="p">,</span> <span class="n">value_name</span><span class="p">,</span> <span class="n">shape_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method will be sparse matrix to dense matrix.</span>
<span class="sd">        Args:</span>
<span class="sd">            index_name (str)</span>
<span class="sd">            value_name (str)</span>
<span class="sd">            shape_name (str)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.add_operation"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.add_operation">[文档]</a>    <span class="k">def</span> <span class="nf">add_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add basic operations from front objects to _operations of Backend.</span>
<span class="sd">        Args:</span>
<span class="sd">            op (list): the operation includes [ret_var_name: str, operation_name, input_var_name1: str, input_var_name2 :str, ...]</span>
<span class="sd">        transformed to : [[return_var_names], operation_name, [input_var_names]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">op</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># op[2]是list，说明本身就采用了list多输入的结构，如果op[3]还有数值，直接不考虑</span>

        <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">:</span>
            <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="c1"># if isinstance(op[0], str):</span>
            <span class="c1">#     op[0] = [op[0]]</span>
            <span class="c1"># elif op[0] is None:</span>
            <span class="c1">#     op[0] = []</span>
            <span class="c1"># op[2] = op[2:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_standalone</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No operation </span><span class="si">%s</span><span class="s2"> in basic_operate&quot;</span> <span class="o">%</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

        <span class="c1"># if isinstance(op[0], str):</span>
        <span class="c1">#     op[0] = [op[0]]</span>
        <span class="c1"># elif op[0] is None:</span>
        <span class="c1">#     op[0] = []</span>
        <span class="c1"># op[2] = op[2:]</span>
        <span class="c1"># if op[1] in self.basic_operate:</span>
        <span class="c1">#     op[1] = self.basic_operate[op[1]]</span>
        <span class="c1"># elif not callable(op[1]):</span>
        <span class="c1">#     raise ValueError(&quot;No operation %s in basic_operate or not exist operation %s&quot; % (op[1], op[1]))</span>
        <span class="c1">#</span>
        <span class="c1"># self._operations.append(op)</span>

<div class="viewcode-block" id="Backend.register_standalone"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.register_standalone">[文档]</a>    <span class="k">def</span> <span class="nf">register_standalone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">input_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add standalone operations from front objects to _standalone_operations of Backend.</span>
<span class="sd">        Args:</span>
<span class="sd">            output_name (str): the name of the return variable of the method</span>
<span class="sd">            funtion (): the standalone method</span>
<span class="sd">            input_names (list): the name of the arguments of the method</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># TODO:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">output_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_names</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">output_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">input_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_names</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">input_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">input_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">op</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_names</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">input_names</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span></div>

        <span class="c1"># self._standalone_operations.append((output_name, function, input_names))</span>

<div class="viewcode-block" id="Backend.register_initial"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.register_initial">[文档]</a>    <span class="k">def</span> <span class="nf">register_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">input_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add initial operations from front objects to _initial_operations of Backend..</span>
<span class="sd">        Args:</span>
<span class="sd">            output_name (str): the name of the return variable of the method</span>
<span class="sd">            funtion (): the standalone method</span>
<span class="sd">            input_names (list): the name of the arguments of the method</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">:</span>
                <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_operate</span><span class="p">[</span><span class="n">function</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No operation </span><span class="si">%s</span><span class="s2"> in basic_operate&quot;</span> <span class="o">%</span> <span class="n">function</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">input_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_names</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">output_name</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">input_names</span><span class="p">))</span></div>

<div class="viewcode-block" id="Backend.store"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.store">[文档]</a>    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Store backend_name and _variables into _stored_states dictionary.</span>
<span class="sd">        Args:</span>
<span class="sd">            name (str, optional): the name of network state.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stored_states</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">)</span></div>

<div class="viewcode-block" id="Backend.restore"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.restore">[文档]</a>    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Restore network state from _stored_states dictionary.</span>
<span class="sd">        Args:</span>
<span class="sd">            name (str): the name of network state.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stored_states</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No network state named: </span><span class="si">%s</span><span class="s2"> is stored&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stored_backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stored_states</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">stored_backend</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The stored network is run by </span><span class="si">%s</span><span class="s2"> not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stored_backend</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stored_states</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="Backend.check_key"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.check_key">[文档]</a>    <span class="k">def</span> <span class="nf">check_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ckey</span><span class="p">,</span> <span class="n">target_dict</span><span class="p">):</span>
        <span class="n">cnetname</span> <span class="o">=</span> <span class="n">ckey</span><span class="p">[:</span><span class="n">ckey</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&lt;net&gt;&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">netname</span> <span class="o">=</span> <span class="n">key</span><span class="p">[:</span><span class="n">key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&lt;net&gt;&#39;</span><span class="p">)]</span>
            <span class="k">break</span>
        <span class="n">ckey</span> <span class="o">=</span> <span class="n">ckey</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cnetname</span><span class="p">,</span> <span class="n">netname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ckey</span> <span class="ow">in</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ckey</span>

        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Key error occurs, please check keys.&#39;</span><span class="p">)</span></div>


        <span class="c1"># result = [key for key in target_dict.keys() if key.endswith(variables[variables.find(&#39;&lt;net&gt;&#39;):])]</span>
        <span class="c1"># if result:</span>
        <span class="c1">#     if len(result) &gt; 1:</span>
        <span class="c1">#         import warnings</span>
        <span class="c1">#         warnings.warn(&#39;Given key matchs two variables in the backend dict, choose the first one as default&#39;)</span>
        <span class="c1">#     result = result[0]</span>
        <span class="c1"># return result</span>

    <span class="c1"># -------- basic backends operations -----</span>
<div class="viewcode-block" id="Backend.threshold"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.threshold">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v_th</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            v: membrane voltage</span>
<span class="sd">            v_th: threshold</span>
<span class="sd">        Returns:</span>
<span class="sd">            v&gt; v_th</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.cat"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.cat">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">cat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Joining data together along a dimension.</span>
<span class="sd">        Note that the total dimension of the data remains the same after cat.</span>
<span class="sd">        Args:</span>
<span class="sd">            x (list):</span>
<span class="sd">            dim (int): the dimension to cat.</span>
<span class="sd">        Returns:</span>
<span class="sd">            concat(x, dim)</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.stack"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.stack">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add new dimension when stack data.</span>
<span class="sd">        Args:</span>
<span class="sd">            x (list):</span>
<span class="sd">            dim (int): the dimension to stack.</span>
<span class="sd">        Returns:</span>
<span class="sd">            stack(x, dim)</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.permute"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.permute">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">permute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">permute_dim</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x---&gt; input</span>
<span class="sd">        permute_dim---&gt; the dimension index of permute operation</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.view"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.view">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">view_dim</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x---&gt; input</span>
<span class="sd">        view_dim---&gt; the shape of view operation</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.assign"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.assign">[文档]</a>    <span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y---&gt; target</span>
<span class="sd">        x---&gt; input</span>
<span class="sd">        y = x</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="Backend.unsqueeze"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.unsqueeze">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">unsqueeze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x---&gt; input</span>
<span class="sd">        dim---&gt; the dim of unsqueeze operation</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.reduce_sum"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.reduce_sum">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">reduce_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">dim</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reduce the dimensions of the data</span>
<span class="sd">        Args:</span>
<span class="sd">            x (list):</span>
<span class="sd">            dim (tuple(int)): the dimension to reduce.</span>
<span class="sd">        Returns:</span>
<span class="sd">            sum(x, dim)</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.index_select"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.index_select">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">index_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x</span>
<span class="sd">        indices</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.scatter"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.scatter">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x</span>
<span class="sd">        indices</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.conv1d"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.conv1d">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">conv1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kernel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x</span>
<span class="sd">        kernel</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.conv_trans1d"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.conv_trans1d">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">conv_trans1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kernel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x</span>
<span class="sd">        kernel</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.im2col_indices"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.im2col_indices">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">im2col_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kh</span><span class="p">,</span> <span class="n">kw</span><span class="p">,</span> <span class="n">padding</span><span class="p">,</span> <span class="n">stride</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x: 4D array  N, FH, FW, C_{in}</span>
<span class="sd">        kh: kernel_height</span>
<span class="sd">        kw: kernel_width</span>
<span class="sd">        stride:</span>
<span class="sd">        padding:</span>
<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.conv2d_flatten"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.conv2d_flatten">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">conv2d_flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x: 4D array (batch_size, out_channels, height, width)</span>
<span class="sd">        Returns</span>
<span class="sd">        3D array (batch_size, out_channels, height * width)</span>
<span class="sd">        ----------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.feature_map_flatten"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.feature_map_flatten">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">feature_map_flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For RSTDP and STDP learning rules which is  follwed with conv pre_layer</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x: 4D array (batch_size, out_channels, height, width)</span>
<span class="sd">        Returns</span>
<span class="sd">        2D array (batch_size, out_channels * height * width)</span>
<span class="sd">        ----------</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.add"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.add">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add the tensor y to the input x and returns a new result.</span>
<span class="sd">        Args:</span>
<span class="sd">            x (Tensor): input</span>
<span class="sd">            y (Tensor or Number): the second input</span>
<span class="sd">        Returns:</span>
<span class="sd">            x + y</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.minus"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.minus">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">minus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The first input minus the second input</span>
<span class="sd">        Args:</span>
<span class="sd">            x (Tensor): input</span>
<span class="sd">            y (Tensor or Number): the second input</span>
<span class="sd">        Returns:</span>
<span class="sd">            x - y</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.div"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.div">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The first input div the second input</span>
<span class="sd">        Args:</span>
<span class="sd">            x (Tensor): input</span>
<span class="sd">            y (Tensor or Number): the second input</span>

<span class="sd">        Returns:</span>
<span class="sd">            x/y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.relu"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.relu">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">relu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Rectified Linear</span>
<span class="sd">        Args:</span>
<span class="sd">            x:</span>

<span class="sd">        Returns:</span>
<span class="sd">            x = x if x&gt;0. else x = 0</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.mat_mult_weight"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.mat_mult_weight">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">mat_mult_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Matrix product.</span>
<span class="sd">        Args:</span>
<span class="sd">            A (Tensor): the first input to be multiplied</span>
<span class="sd">            X (Tensor): the second input to be multiplied</span>
<span class="sd">        Returns:</span>
<span class="sd">            mat_mult_weight(A,X)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.mat_mult_weight_complex"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.mat_mult_weight_complex">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">mat_mult_weight_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.mat_mult_pre"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.mat_mult_pre">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">mat_mult_pre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Matrix product.</span>
<span class="sd">        Args:</span>
<span class="sd">            A (Tensor): the first input to be multiplied</span>
<span class="sd">            X (Tensor): the second input to be multiplied</span>
<span class="sd">        Returns:</span>
<span class="sd">            mat_mult_pre(A,X)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.sigmoid"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.sigmoid">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            x:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Backend.mat_mult"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.mat_mult">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">mat_mult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Matrix product.</span>
<span class="sd">        Args:</span>
<span class="sd">            A (Tensor): the first input to be multiplied</span>
<span class="sd">            X (Tensor): the second input to be multiplied</span>
<span class="sd">        Returns:</span>
<span class="sd">            mat_mult(A,X)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.reshape_mat_mult"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.reshape_mat_mult">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">reshape_mat_mult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Matrix product.</span>
<span class="sd">        Args:</span>
<span class="sd">            A (Tensor): the first input to be multiplied</span>
<span class="sd">            X (Tensor): the second input to be multiplied</span>
<span class="sd">        Returns:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.bmm"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.bmm">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">bmm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Performs a batch matrix-matrix product.</span>
<span class="sd">        Args:</span>
<span class="sd">            A (Tensor): the first input to be multiplied  [batch_size, n, m]</span>
<span class="sd">            X (Tensor): the second input to be multiplied  [batch_size, m, p]</span>
<span class="sd">        Returns:</span>
<span class="sd">            bmm(A,X)   [batch_size, n, p]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.sparse_mat_mult_weight"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.sparse_mat_mult_weight">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">sparse_mat_mult_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sparse matrix product.</span>
<span class="sd">        Args:</span>
<span class="sd">            A (Tensor): the first input to be multiplied</span>
<span class="sd">            X (Tensor): the second input to be multiplied</span>
<span class="sd">        Returns:</span>
<span class="sd">            sparse_mat_mult_weight(A,X)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.var_mult"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.var_mult">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">var_mult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            A, X</span>
<span class="sd">        Returns:</span>
<span class="sd">            A * X</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.mult_sum_weight"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.mult_sum_weight">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">mult_sum_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">         sum(A*X, dim=-2)</span>
<span class="sd">        Args:</span>
<span class="sd">            A:</span>
<span class="sd">            X:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.mat_linear"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.mat_linear">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">mat_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            A</span>
<span class="sd">            X</span>
<span class="sd">            b</span>
<span class="sd">        Returns:</span>
<span class="sd">            mat_mul(A,X)+b</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.ger"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.ger">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">ger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            A</span>
<span class="sd">            X</span>
<span class="sd">        Returns:</span>
<span class="sd">            ger(A,X)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.var_linear"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.var_linear">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">var_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        If A is matrix, then A and X should have the same shape, A*X is elemen-wise multiplication</span>
<span class="sd">        else  A should be a scalar value.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A*X +b</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.to_numpy"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.to_numpy">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args：</span>
<span class="sd">            data</span>
<span class="sd">        Returns:</span>
<span class="sd">            data.numpy()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.to_tensor"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.to_tensor">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">to_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            data</span>
<span class="sd">        Returns:</span>
<span class="sd">            torch.tensor(data)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.clamp_"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.clamp_">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">clamp_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            in-place clamp the data</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.clamp_max_"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.clamp_max_">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">clamp_max_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            in-place clamp the max of the data</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.clamp_min_"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.clamp_min_">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">clamp_min_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="nb">min</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            in-place clamp the min of the data</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.uniform"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.uniform">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">uniform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            data(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">            a(float): the lower bound of the uniform distribution</span>
<span class="sd">            b(float): the upper bound of the uniform distribution</span>
<span class="sd">        Returns:</span>
<span class="sd">            torch.nn.init.uniform_(data, a=0.0, b=1.0)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.normal"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.normal">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            data(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">            mean(float): the mean of the normal distribution</span>
<span class="sd">            std(float): the standard deviation of the normal distribution</span>
<span class="sd">        Returns:</span>
<span class="sd">            torch.nn.init.normal_(data, mean=0.0, std=1.0)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.xavier_normal"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.xavier_normal">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">xavier_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            data(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">            gain: an optional scaling factor</span>
<span class="sd">        Returns:</span>
<span class="sd">            torch.nn.init.xavier_normal_(data, gain=1.0)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.xavier_uniform"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.xavier_uniform">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">xavier_uniform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            data(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">            gain: an optional scaling factor</span>
<span class="sd">        Returns:</span>
<span class="sd">            torch.nn.init.xavier_uniform_(data, gain=1.0)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.kaiming_normal"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.kaiming_normal">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">kaiming_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;fan_in&#39;</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="s1">&#39;leaky_relu&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            data(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">            a: the negative slope of the rectifier used after this layer (only used with &#39;leaky_relu&#39;)</span>
<span class="sd">            mode: either &#39;fan_in&#39; (default) or &#39;fan_out&#39;. Choosing &#39;fan_in&#39; preserves the magnitude of the variance of the weights in the forward pass. Choosing &#39;fan_out&#39; preserves the magnitudes in the backwards pass.</span>
<span class="sd">            nonlinearity: the non-linear function (nn.functional name), recommended to use only with &#39;relu&#39; or &#39;leaky_relu&#39; (default).</span>
<span class="sd">        Returns:</span>
<span class="sd">            torch.nn.init.kaiming_normal_(data, a=0, mode=&#39;fan_in&#39;, nonlinearity=&#39;leaky_relu&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.kaiming_uniform"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.kaiming_uniform">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">kaiming_uniform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;fan_in&#39;</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="s1">&#39;leaky_relu&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            data(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">            a: the negative slope of the rectifier used after this layer (only used with &#39;leaky_relu&#39;)</span>
<span class="sd">            mode: either &#39;fan_in&#39; (default) or &#39;fan_out&#39;. Choosing &#39;fan_in&#39; preserves the magnitude of the variance of the weights in the forward pass. Choosing &#39;fan_out&#39; preserves the magnitudes in the backwards pass.</span>
<span class="sd">            nonlinearity: the non-linear function (nn.functional name), recommended to use only with &#39;relu&#39; or &#39;leaky_relu&#39; (default).</span>
<span class="sd">        Returns:</span>
<span class="sd">            torch.nn.init.kaiming_uniform_(data, a=0, mode=&#39;fan_in&#39;, nonlinearity=&#39;leaky_relu&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.zero_init"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.zero_init">[文档]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">zero_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">constant_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            data(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">            constant_value(float): the value to fill the tensor with</span>
<span class="sd">        Returns:</span>
<span class="sd">            torch.nn.init.constant_(data, constant_value)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def euler_update(self):</span>
    <span class="c1">#     pass</span>
    <span class="c1">#</span>
    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def rk2_update(self):</span>
    <span class="c1">#     pass</span>
    <span class="c1">#</span>
    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def reset(self, v, v_reset, u_reset, spike):</span>
    <span class="c1">#      &#39;&#39;&#39;</span>
    <span class="c1">#      voltage reset</span>
    <span class="c1">#</span>
    <span class="c1">#      Parameters</span>
    <span class="c1">#      ----------</span>
    <span class="c1">#      v</span>
    <span class="c1">#      v_reset</span>
    <span class="c1">#      u_reset</span>
    <span class="c1">#      spike</span>
    <span class="c1">#</span>
    <span class="c1">#      Returns</span>
    <span class="c1">#      -------</span>
    <span class="c1">#      v[spike] = v_reset</span>
    <span class="c1">#      v[spike] += u_reset</span>
    <span class="c1">#      &#39;&#39;&#39;</span>
    <span class="c1">#</span>
    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def reset_u(self, u, u_reset, spike):</span>
    <span class="c1">#      &#39;&#39;&#39;</span>
    <span class="c1">#      recovery reset</span>
    <span class="c1">#</span>
    <span class="c1">#      Parameters</span>
    <span class="c1">#      ----------</span>
    <span class="c1">#      u</span>
    <span class="c1">#      _reset</span>
    <span class="c1">#      spike</span>
    <span class="c1">#</span>
    <span class="c1">#      Returns</span>
    <span class="c1">#      -------</span>
    <span class="c1">#      u[spike] = u+u_reset</span>
    <span class="c1">#      &#39;&#39;&#39;</span>
    <span class="c1">#      NotImplementedError()</span>
    <span class="c1">#</span>
    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def next_stage(self, x):</span>
    <span class="c1">#     &#39;&#39;&#39;</span>
    <span class="c1">#</span>
    <span class="c1">#    Parameters</span>
    <span class="c1">#    ----------</span>
    <span class="c1">#    x: list</span>
    <span class="c1">#</span>
    <span class="c1">#    Returns</span>
    <span class="c1">#    -------</span>
    <span class="c1">#    x[index]</span>
    <span class="c1">#    &#39;&#39;&#39;</span>
    <span class="c1">#</span>
    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def izh_v(self, v, u, psp):</span>
    <span class="c1">#     &#39;&#39;&#39;</span>
    <span class="c1">#</span>
    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     v: list</span>
    <span class="c1">#     u: list</span>
    <span class="c1">#     psp: list</span>
    <span class="c1">#</span>
    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     V=V+dt*(0.04*V^2+5*V+140-U+PSP)</span>
    <span class="c1">#     &#39;&#39;&#39;</span>
    <span class="c1">#     NotImplementedError()</span>
    <span class="c1">#</span>
    <span class="c1"># @abstractmethod</span>
    <span class="c1"># def izh_u(self, a, b, v, u):</span>
    <span class="c1">#     &#39;&#39;&#39;</span>
    <span class="c1">#</span>
    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     a: list</span>
    <span class="c1">#     b: list</span>
    <span class="c1">#     u: list</span>
    <span class="c1">#     v: list</span>
    <span class="c1">#</span>
    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     U=U+a*(b*V-U)</span>
    <span class="c1">#     &#39;&#39;&#39;</span>
    <span class="c1">#     NotImplementedError()</span>

<div class="viewcode-block" id="Backend.exp"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.exp">[文档]</a>    <span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            x(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">        Returns:</span>
<span class="sd">           return exp(x)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.sin"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.sin">[文档]</a>    <span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            x(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">        Returns:</span>
<span class="sd">           return exp(x)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.cos"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.cos">[文档]</a>    <span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            x(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">        Returns:</span>
<span class="sd">           return exp(x)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.tan"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.tan">[文档]</a>    <span class="k">def</span> <span class="nf">tan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            x(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">        Returns:</span>
<span class="sd">           return exp(x)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.log"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.log">[文档]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            x(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">        Returns:</span>
<span class="sd">           return exp(x)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.log2"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.log2">[文档]</a>    <span class="k">def</span> <span class="nf">log2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            x(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">        Returns:</span>
<span class="sd">           return exp(x)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.log10"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.log10">[文档]</a>    <span class="k">def</span> <span class="nf">log10</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            x(tensor): an n-dimensional torch.Tensor</span>
<span class="sd">        Returns:</span>
<span class="sd">           return exp(x)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Backend.reset"><a class="viewcode-back" href="../../../spaic.Simulation.html#spaic.Backend.Backend.Backend.reset">[文档]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Reset voltage</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="ne">NotImplementedError</span><span class="p">()</span></div></div>


<span class="c1"># class Darwin_Backend(Backend):</span>
<span class="c1">#</span>
<span class="c1">#     def __init__(self):</span>
<span class="c1">#         super(Darwin_Backend, self).__init__()</span>
<span class="c1">#         pass</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2021, Zhejiang Lab.

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>